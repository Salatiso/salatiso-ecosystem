(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6542],{30846:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/sync",function(){return s(11716)}])},52217:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});const n=(0,s(63759).Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},50039:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});const n=(0,s(63759).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},44976:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});const n=(0,s(63759).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},24420:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});const n=(0,s(63759).Z)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]])},12658:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});const n=(0,s(63759).Z)("WifiOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 4.17-2.65",key:"11utq1"}],["path",{d:"M10.66 5c4.01-.36 8.14.9 11.34 3.76",key:"hxefdu"}],["path",{d:"M16.85 11.25a10 10 0 0 1 2.22 1.68",key:"q734kn"}],["path",{d:"M5 13a10 10 0 0 1 5.24-2.76",key:"piq4yl"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]])},32203:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});const n=(0,s(63759).Z)("Wifi",[["path",{d:"M5 13a10 10 0 0 1 14 0",key:"6v8j51"}],["path",{d:"M8.5 16.5a5 5 0 0 1 7 0",key:"sej527"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["line",{x1:"12",x2:"12.01",y1:"20",y2:"20",key:"of4bc4"}]])},93517:function(e,t,s){"use strict";s.d(t,{SP:function(){return d},dr:function(){return o},mQ:function(){return c},nU:function(){return l}});var n=s(85893),a=s(67294);const i=(0,a.createContext)(void 0),r=()=>{const e=(0,a.useContext)(i);if(!e)throw new Error("Tabs components must be used within Tabs");return e},c=e=>{let{defaultValue:t,value:s,onValueChange:r,children:c,className:o=""}=e;const[d,l]=(0,a.useState)(t),h=void 0!==s?s:d;return(0,n.jsx)(i.Provider,{value:{value:h,onChange:e=>{void 0===s&&l(e),null===r||void 0===r||r(e)}},children:(0,n.jsx)("div",{className:o,children:c})})},o=e=>{let{children:t,className:s=""}=e;return(0,n.jsx)("div",{className:"inline-flex h-10 items-center justify-center rounded-md bg-gray-100 p-1 text-gray-500 ".concat(s),children:t})},d=e=>{let{value:t,children:s,className:a=""}=e;const{value:i,onChange:c}=r(),o=t===i;return(0,n.jsx)("button",{onClick:()=>c(t),className:"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-white transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 ".concat(o?"bg-white text-gray-900 shadow-sm":"text-gray-600 hover:text-gray-900"," ").concat(a),children:s})},l=e=>{let{value:t,children:s,className:a=""}=e;const{value:i}=r();return t!==i?null:(0,n.jsx)("div",{className:"mt-2 ring-offset-white focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 ".concat(a),children:s})}},11716:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return q}});var n=s(85893),a=s(67294),i=s(9008),r=s.n(i),c=s(35047);const o=(0,s(63759).Z)("CheckCircle2",[["path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",key:"14v8dr"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);var d=s(46611),l=s(50039),h=s(12658),u=s(43765),p=s(32203);const m=(0,a.createContext)(void 0),g=e=>{let{children:t}=e;const[s,i]=(0,a.useReducer)(f,y),r=(0,a.useCallback)((e=>{const t={...e,id:"evt_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),timestamp:Date.now(),signature:(e,"sig_".concat(Math.random().toString(36).substr(2,9)))};s.meshConnected?(i({type:"QUEUE_EVENT",event:t}),i({type:"SET_STATUS",status:"syncing"}),setTimeout((()=>{i({type:"SET_STATUS",status:"synced"}),i({type:"UPDATE_LAST_SYNC"})}),500)):(i({type:"QUEUE_OFFLINE_EVENT",event:t}),i({type:"SET_STATUS",status:"offline"}))}),[s.meshConnected]),c=(0,a.useCallback)((async()=>{if(s.meshConnected){i({type:"SET_STATUS",status:"syncing"});try{await new Promise((e=>setTimeout(e,1e3))),s.pendingEvents.forEach((e=>{i({type:"PROCESS_DELTA",delta:{eventId:e.id,previousVersion:e.version-1,currentVersion:e.version,changes:{data:{old:null,new:e.data}},metadata:{changedBy:e.userId,changedAt:e.timestamp,device:"ecosystem-app"}}})})),i({type:"SET_STATUS",status:"synced"}),i({type:"UPDATE_LAST_SYNC"})}catch(e){i({type:"SET_STATUS",status:"error"})}}}),[s.pendingEvents,s.meshConnected]),o=(0,a.useCallback)(((e,t)=>{i({type:"RESOLVE_CONFLICT",conflictId:e,resolution:t})}),[]),d=(0,a.useCallback)((()=>{i({type:"CLEAR_OFFLINE_QUEUE"})}),[]),l=(0,a.useCallback)((e=>{i({type:"SET_MESH",priority:e})}),[]);return(0,n.jsx)(m.Provider,{value:{state:s,publishEvent:r,syncNow:c,resolveConflict:o,clearOfflineQueue:d,setMeshConnection:l},children:t})},x=()=>{const e=(0,a.useContext)(m);if(!e)throw new Error("useSync must be used within SyncProvider");return e},y={status:"offline",lastSyncTime:0,pendingEvents:[],conflicts:[],meshConnected:null,queuedOperations:[]};function f(e,t){switch(t.type){case"SET_STATUS":return{...e,status:t.status};case"QUEUE_EVENT":return{...e,pendingEvents:[...e.pendingEvents,t.event]};case"QUEUE_OFFLINE_EVENT":return{...e,pendingEvents:[...e.pendingEvents,t.event],queuedOperations:[...e.queuedOperations,{id:t.event.id,retries:0,maxRetries:5}]};case"PROCESS_DELTA":return{...e,pendingEvents:e.pendingEvents.filter((e=>e.id!==t.delta.eventId))};case"ADD_CONFLICT":return{...e,conflicts:[...e.conflicts,t.conflict]};case"RESOLVE_CONFLICT":return{...e,conflicts:e.conflicts.map((e=>e.id===t.conflictId?{...e,resolution:t.resolution,resolvedAt:Date.now()}:e))};case"UPDATE_LAST_SYNC":return{...e,lastSyncTime:Date.now()};case"CLEAR_OFFLINE_QUEUE":return{...e,queuedOperations:[],pendingEvents:[]};case"SET_MESH":return{...e,meshConnected:t.priority,status:t.priority?"synced":"offline"};default:return e}}const N=()=>{const{state:e}=x(),t={synced:{icon:(0,n.jsx)(o,{className:"w-4 h-4"}),label:"Synced",color:"text-green-600",bg:"bg-green-50"},syncing:{icon:(0,n.jsx)(d.Z,{className:"w-4 h-4 animate-pulse"}),label:"Syncing...",color:"text-blue-600",bg:"bg-blue-50"},pending:{icon:(0,n.jsx)(l.Z,{className:"w-4 h-4"}),label:"Pending",color:"text-amber-600",bg:"bg-amber-50"},offline:{icon:(0,n.jsx)(h.Z,{className:"w-4 h-4"}),label:"Offline",color:"text-gray-600",bg:"bg-gray-50"},error:{icon:(0,n.jsx)(u.Z,{className:"w-4 h-4"}),label:"Error",color:"text-red-600",bg:"bg-red-50"}}[e.status],s=e.lastSyncTime>0?new Date(e.lastSyncTime).toLocaleTimeString():"Never";return(0,n.jsxs)("div",{className:"".concat(t.bg," rounded-lg p-3 border border-gray-200"),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("span",{className:t.color,children:t.icon}),(0,n.jsx)("span",{className:"font-semibold text-gray-900",children:t.label})]}),e.meshConnected&&(0,n.jsxs)("span",{className:"text-xs font-medium text-gray-600",children:["via ",e.meshConnected.toUpperCase()]})]}),(0,n.jsxs)("div",{className:"text-xs text-gray-600 space-y-1",children:[(0,n.jsxs)("p",{children:["Last sync: ",s]}),e.pendingEvents.length>0&&(0,n.jsxs)("p",{className:"text-amber-600",children:[e.pendingEvents.length," pending operation(s)"]}),e.conflicts.length>0&&(0,n.jsxs)("p",{className:"text-red-600",children:[e.conflicts.length," conflict(s) to resolve"]})]})]})},b=()=>{const{state:e,setMeshConnection:t}=x();return(0,n.jsxs)("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[(0,n.jsx)("h3",{className:"font-semibold text-gray-900 mb-3",children:"Mesh Network (Sonny)"}),(0,n.jsx)("div",{className:"space-y-2 mb-4",children:["wifi","bluetooth","internet"].map((s=>(0,n.jsxs)("button",{onClick:()=>(e=>{t(e)})(s),className:"w-full flex items-center gap-3 px-3 py-2 rounded-lg transition text-sm font-medium ".concat(e.meshConnected===s?"bg-blue-100 text-blue-700 border border-blue-300":"bg-gray-50 text-gray-700 border border-gray-200 hover:bg-gray-100"),children:[(0,n.jsx)(p.Z,{className:"w-4 h-4"}),(0,n.jsx)("span",{className:"capitalize",children:s}),e.meshConnected===s&&(0,n.jsx)(o,{className:"w-4 h-4 ml-auto"})]},s)))}),e.meshConnected&&(0,n.jsx)("button",{onClick:()=>{t(null)},className:"w-full px-3 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 transition text-sm font-medium border border-red-200",children:"Disconnect"}),(0,n.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200 text-xs text-gray-600",children:[(0,n.jsx)("p",{children:"Priority: WiFi \u2192 Bluetooth \u2192 Internet"}),(0,n.jsx)("p",{className:"mt-1",children:e.meshConnected?"Connected via ".concat(e.meshConnected):"Disconnected - queuing offline"})]})]})},w=()=>{const{state:e,resolveConflict:t}=x();return 0===e.conflicts.length?(0,n.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 text-center",children:(0,n.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"\u2713 No conflicts - everything is in sync!"})}):(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("h3",{className:"font-semibold text-gray-900",children:["Resolve Conflicts (",e.conflicts.length,")"]}),e.conflicts.map((e=>(0,n.jsxs)("div",{className:"bg-white border-2 border-red-200 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:"font-semibold text-gray-900",children:[e.entityType,": ",e.entityId]}),(0,n.jsxs)("p",{className:"text-xs text-gray-600",children:["v",e.localVersion," (local) vs v",e.remoteVersion," ","(remote)"]})]}),e.resolution&&(0,n.jsxs)("span",{className:"px-2 py-1 text-xs bg-green-100 text-green-700 rounded font-medium",children:["\u2713 ",e.resolution]})]}),!e.resolution&&(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>t(e.id,"local-wins"),className:"flex-1 px-3 py-2 text-sm font-medium bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition",children:"Keep Local"}),(0,n.jsx)("button",{onClick:()=>t(e.id,"remote-wins"),className:"flex-1 px-3 py-2 text-sm font-medium bg-purple-50 text-purple-700 rounded-lg hover:bg-purple-100 transition",children:"Accept Remote"}),(0,n.jsx)("button",{onClick:()=>t(e.id,"merge"),className:"flex-1 px-3 py-2 text-sm font-medium bg-green-50 text-green-700 rounded-lg hover:bg-green-100 transition",children:"Merge"})]})]},e.id)))]})},v=()=>{const{state:e,syncNow:t,clearOfflineQueue:s}=x();return(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h3",{className:"font-semibold text-gray-900",children:["Pending Sync Events (",e.pendingEvents.length,")"]}),(0,n.jsx)("div",{className:"flex gap-2",children:e.pendingEvents.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("button",{onClick:()=>t(),className:"px-3 py-1 text-sm bg-blue-600 text-white rounded hover:bg-blue-700 transition",children:"Sync Now"}),(0,n.jsx)("button",{onClick:()=>s(),className:"px-3 py-1 text-sm bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition",children:"Clear Queue"})]})})]}),e.pendingEvents.length>0?(0,n.jsx)("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-4",children:(0,n.jsxs)("ul",{className:"space-y-2",children:[e.pendingEvents.slice(0,5).map((e=>(0,n.jsxs)("li",{className:"text-xs font-medium text-amber-800",children:[(0,n.jsx)("span",{className:"inline-block w-16 font-bold",children:e.type}),(0,n.jsx)("span",{className:"inline-block w-24",children:e.entityType}),(0,n.jsx)("span",{className:"text-amber-600",children:e.entityId})]},e.id))),e.pendingEvents.length>5&&(0,n.jsxs)("li",{className:"text-xs text-amber-600 font-medium",children:["... and ",e.pendingEvents.length-5," more"]})]})}):(0,n.jsx)("div",{className:"text-center py-4 text-gray-600 text-sm",children:"All events synced \u2713"}),e.queuedOperations.length>0&&(0,n.jsxs)("div",{className:"text-xs text-gray-600 p-2 bg-gray-50 rounded",children:[e.queuedOperations.length," offline operation(s) queued"]})]})},E=()=>(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Sync Control Center"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Real-time sync engine with mesh networking and conflict resolution"})]}),(0,n.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(N,{}),(0,n.jsx)(b,{})]}),(0,n.jsxs)("div",{className:"lg:col-span-2 space-y-4",children:[(0,n.jsx)(v,{}),(0,n.jsx)(w,{})]})]}),(0,n.jsxs)("div",{className:"mt-8 p-4 bg-blue-50 border border-blue-200 rounded-lg space-y-2 text-sm text-gray-700",children:[(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Delta Sync:"})," Only changes are synced, reducing bandwidth by up to 90%"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Mesh Priority:"})," Automatically prioritizes fastest available connection (WiFi \u2192 Bluetooth \u2192 Internet)"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Offline Support:"})," Changes queue automatically and sync when connection returns"]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("strong",{children:"Conflict Resolution:"})," Automatic merging with manual override when needed"]})]})]});var S,j,C=s(97042),I=s(99724),D=s(34155);!function(e){e.DISCONNECTED="DISCONNECTED",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.ERROR="ERROR",e.SYNCING="SYNCING"}(S||(S={})),function(e){e.PING="PING",e.PONG="PONG",e.SYNC_REQUEST="SYNC_REQUEST",e.SYNC_RESPONSE="SYNC_RESPONSE",e.DATA_UPDATE="DATA_UPDATE",e.PRESENCE_UPDATE="PRESENCE_UPDATE",e.COMMAND="COMMAND"}(j||(j={}));const O=new class{async initialize(e){if(!e)throw new Error("User ID is required to initialize BridgeService");this.userId=e,this.deviceId=this.generateDeviceId();try{this.setStatus("CONNECTING"),await this.registerDevice(),this.startMessageListener(),this.startDeviceListener(),this.startHeartbeat(),this.setStatus("CONNECTED")}catch(t){throw this.setStatus("ERROR"),t}}disconnect(){this.heartbeatInterval&&(clearInterval(this.heartbeatInterval),this.heartbeatInterval=null),this.unsubscribers.forEach((e=>e())),this.unsubscribers=[],this.connectedDevices.clear(),this.messageQueue=[],this.setStatus("DISCONNECTED")}async sendMessage(e,t,s){const n={id:this.generateMessageId(),type:e,payload:t,timestamp:Date.now(),deviceId:this.deviceId,userId:this.userId};try{const e=(0,I.JU)((0,I.hJ)(C.db,"bridge_messages"),n.id);await(0,I.pl)(e,{...n,targetDeviceId:s||null,read:!1,createdAt:new Date})}catch(a){throw this.messageQueue.push(n),a}}async requestSync(e){this.setStatus("SYNCING"),this.syncProgress={total:e.length,completed:0,failed:0,inProgress:e.length,lastSync:Date.now()},await this.sendMessage("SYNC_REQUEST",{collections:e,timestamp:Date.now()}),this.notifyListeners("syncProgress",this.syncProgress)}getStatus(){return this.status}getConnectedDevices(){return Array.from(this.connectedDevices.values())}getSyncProgress(){return{...this.syncProgress}}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{const s=this.listeners.get(e);s&&s.delete(t)}}async registerDevice(){const e={id:this.deviceId,name:this.getDeviceName(),type:"web",lastSeen:Date.now(),version:D.env.NEXT_PUBLIC_APP_VERSION||"1.0.0",status:"online"},t=(0,I.JU)(C.db,"bridge_devices",this.deviceId);await(0,I.pl)(t,{...e,userId:this.userId,updatedAt:new Date},{merge:!0}),this.connectedDevices.set(this.deviceId,e)}startMessageListener(){const e=(0,I.hJ)(C.db,"bridge_messages"),t=(0,I.IO)(e,(0,I.ar)("userId","==",this.userId),(0,I.ar)("read","==",!1),(0,I.Xo)("timestamp","desc"),(0,I.b9)(50)),s=(0,I.cf)(t,(e=>{e.docChanges().forEach((async e=>{if("added"===e.type){const t=e.doc.data();if(t.deviceId===this.deviceId)return;if(t.targetDeviceId&&t.targetDeviceId!==this.deviceId)return;this.handleIncomingMessage(t),await(0,I.pl)(e.doc.ref,{read:!0},{merge:!0})}}))}));this.unsubscribers.push(s)}startDeviceListener(){const e=(0,I.hJ)(C.db,"bridge_devices"),t=(0,I.IO)(e,(0,I.ar)("userId","==",this.userId)),s=(0,I.cf)(t,(e=>{e.forEach((e=>{const t=e.data(),s=Date.now()-t.lastSeen<3e4;t.status=s?"online":"offline",this.connectedDevices.set(t.id,t)})),this.notifyListeners("devicesUpdated",this.getConnectedDevices())}));this.unsubscribers.push(s)}handleIncomingMessage(e){switch(e.type){case"PING":this.sendMessage("PONG",{timestamp:Date.now()},e.deviceId);break;case"SYNC_RESPONSE":this.handleSyncResponse(e.payload);break;case"DATA_UPDATE":this.notifyListeners("dataUpdate",e.payload);break;case"PRESENCE_UPDATE":this.notifyListeners("presenceUpdate",e.payload)}}handleSyncResponse(e){e.success?(this.syncProgress.completed++,this.syncProgress.inProgress--):(this.syncProgress.failed++,this.syncProgress.inProgress--),0===this.syncProgress.inProgress&&(this.setStatus("CONNECTED"),this.syncProgress.lastSync=Date.now()),this.notifyListeners("syncProgress",this.syncProgress)}startHeartbeat(){this.heartbeatInterval=setInterval((async()=>{try{const e=(0,I.JU)(C.db,"bridge_devices",this.deviceId);await(0,I.pl)(e,{lastSeen:Date.now(),status:"online",updatedAt:new Date},{merge:!0}),await this.processMessageQueue()}catch(e){}}),15e3)}async processMessageQueue(){if(0===this.messageQueue.length)return;const e=[...this.messageQueue];this.messageQueue=[];for(const s of e)try{await this.sendMessage(s.type,s.payload)}catch(t){this.messageQueue.push(s)}}setStatus(e){this.status=e,this.notifyListeners("statusChanged",e)}notifyListeners(e,t){const s=this.listeners.get(e);s&&s.forEach((e=>{try{e(t)}catch(s){}}))}generateDeviceId(){{let e=localStorage.getItem("deviceId");return e||(e="web_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("deviceId",e)),e}}generateMessageId(){return"msg_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}getDeviceName(){return"".concat(navigator.platform," - ").concat(navigator.userAgent.split("(")[0].trim())}constructor(){this.status="DISCONNECTED",this.messageQueue=[],this.connectedDevices=new Map,this.listeners=new Map,this.unsubscribers=[],this.heartbeatInterval=null,this.deviceId="",this.userId="",this.syncProgress={total:0,completed:0,failed:0,inProgress:0,lastSync:null}}};var T;!function(e){e.DISCOVERING="DISCOVERING",e.CONNECTING="CONNECTING",e.CONNECTED="CONNECTED",e.DISCONNECTED="DISCONNECTED",e.ERROR="ERROR"}(T||(T={}));const P=new class{async initialize(e,t,s){if(!e||!t)throw new Error("User ID and Device ID are required");this.userId=e,this.deviceId=t,this.config={...this.config,...s};try{await this.startPeerDiscovery(),this.listenForConnectionOffers(),this.startDiscoveryLoop()}catch(n){throw n}}shutdown(){this.discoveryInterval&&(clearInterval(this.discoveryInterval),this.discoveryInterval=null),this.connections.forEach(((e,t)=>{this.disconnectPeer(t)})),this.unsubscribers.forEach((e=>e())),this.unsubscribers=[],this.peers.clear(),this.connections.clear(),this.dataChannels.clear(),this.pendingOffers.clear(),this.pendingAnswers.clear()}async connectToPeer(e){if(!this.connections.has(e)){if(this.peers.size>=this.config.maxPeers)throw new Error("Maximum peer connections reached");try{const t=this.createPeerConnection(e);this.connections.set(e,t);const s=t.createDataChannel("mesh-data",{ordered:!0,maxRetransmits:3});this.setupDataChannel(e,s);const n=await t.createOffer();await t.setLocalDescription(n);const a=(0,I.JU)(C.db,"mesh_signals","".concat(this.deviceId,"_").concat(e));await(0,I.pl)(a,{type:"offer",from:this.deviceId,to:e,offer:JSON.stringify(n),timestamp:Date.now(),userId:this.userId}),this.updatePeerStatus(e,"CONNECTING")}catch(t){throw this.disconnectPeer(e),t}}}disconnectPeer(e){const t=this.connections.get(e);t&&(t.close(),this.connections.delete(e)),this.dataChannels.delete(e);const s=this.peers.get(e);s&&(s.status="DISCONNECTED",this.notifyListeners("peerDisconnected",s)),this.syncStats.peersConnected=this.connections.size,this.notifyListeners("statsUpdated",this.syncStats)}async sendData(e,t){const s={...e,sourceDevice:this.deviceId,timestamp:Date.now()},n=JSON.stringify(s);if(t){const e=this.dataChannels.get(t);if(!e||"open"!==e.readyState)throw new Error("No open channel to peer: ".concat(t));e.send(n),this.updateBandwidth(n.length)}else this.dataChannels.forEach(((e,t)=>{"open"===e.readyState&&(e.send(n),this.updateBandwidth(n.length))}))}async queryMesh(e,t){const s={id:this.generatePacketId(),type:"query",collection:e,data:t,version:1};return new Promise((t=>{const n=[],a=(setTimeout((()=>{this.off("dataReceived",a),t(n)}),5e3),t=>{"query"===t.type&&t.collection===e&&n.push(t)});this.on("dataReceived",a),this.sendData(s)}))}getPeers(){return Array.from(this.peers.values())}getStats(){return{...this.syncStats}}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{const s=this.listeners.get(e);s&&s.delete(t)}}off(e,t){const s=this.listeners.get(e);s&&s.delete(t)}async startPeerDiscovery(){const e=(0,I.JU)(C.db,"mesh_peers",this.deviceId);await(0,I.pl)(e,{deviceId:this.deviceId,userId:this.userId,name:this.getDeviceName(),type:"web",available:!0,lastSeen:Date.now(),timestamp:new Date});const t=(0,I.hJ)(C.db,"mesh_peers"),s=(0,I.IO)(t,(0,I.ar)("userId","==",this.userId),(0,I.ar)("available","==",!0)),n=(0,I.cf)(s,(e=>{e.forEach((e=>{const t=e.data();if(t.deviceId===this.deviceId)return;if(Date.now()-t.lastSeen>3e4)return;const s={id:t.deviceId,deviceId:t.deviceId,name:t.name||"Unknown Device",type:t.type||"web",status:"DISCOVERING",latency:0,lastSeen:t.lastSeen,dataSize:t.dataSize||0};this.peers.has(s.id)||(this.peers.set(s.id,s),this.notifyListeners("peerDiscovered",s),this.connections.size<this.config.maxPeers&&this.connectToPeer(s.id).catch(console.error))}))}));this.unsubscribers.push(n)}listenForConnectionOffers(){const e=(0,I.hJ)(C.db,"mesh_signals"),t=(0,I.IO)(e,(0,I.ar)("to","==",this.deviceId),(0,I.ar)("userId","==",this.userId)),s=(0,I.cf)(t,(e=>{e.docChanges().forEach((async e=>{if("added"===e.type){const t=e.doc.data();"offer"===t.type?await this.handleOffer(t.from,JSON.parse(t.offer)):"answer"===t.type?await this.handleAnswer(t.from,JSON.parse(t.answer)):"ice-candidate"===t.type&&await this.handleIceCandidate(t.from,JSON.parse(t.candidate)),await(0,I.oe)(e.doc.ref)}}))}));this.unsubscribers.push(s)}async handleOffer(e,t){try{const s=this.createPeerConnection(e);this.connections.set(e,s),await s.setRemoteDescription(new RTCSessionDescription(t));const n=await s.createAnswer();await s.setLocalDescription(n);const a=(0,I.JU)(C.db,"mesh_signals","".concat(this.deviceId,"_").concat(e,"_answer"));await(0,I.pl)(a,{type:"answer",from:this.deviceId,to:e,answer:JSON.stringify(n),timestamp:Date.now(),userId:this.userId}),this.updatePeerStatus(e,"CONNECTING")}catch(s){this.disconnectPeer(e)}}async handleAnswer(e,t){try{const s=this.connections.get(e);s&&await s.setRemoteDescription(new RTCSessionDescription(t))}catch(s){this.disconnectPeer(e)}}async handleIceCandidate(e,t){const s=this.connections.get(e);if(s)try{await s.addIceCandidate(new RTCIceCandidate(t))}catch(n){}}createPeerConnection(e){const t=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});return t.onicecandidate=async t=>{if(t.candidate){const s=(0,I.JU)(C.db,"mesh_signals","".concat(this.deviceId,"_").concat(e,"_ice_").concat(Date.now()));await(0,I.pl)(s,{type:"ice-candidate",from:this.deviceId,to:e,candidate:JSON.stringify(t.candidate),timestamp:Date.now(),userId:this.userId})}},t.onconnectionstatechange=()=>{switch(t.connectionState){case"connected":this.updatePeerStatus(e,"CONNECTED"),this.syncStats.peersConnected=this.connections.size,this.notifyListeners("statsUpdated",this.syncStats);break;case"disconnected":case"failed":case"closed":this.disconnectPeer(e)}},t.ondatachannel=t=>{this.setupDataChannel(e,t.channel)},t}setupDataChannel(e,t){this.dataChannels.set(e,t),t.onopen=()=>{this.updatePeerStatus(e,"CONNECTED")},t.onclose=()=>{this.disconnectPeer(e)},t.onerror=t=>{this.updatePeerStatus(e,"ERROR")},t.onmessage=e=>{try{const t=JSON.parse(e.data);this.syncStats.totalDataSynced+=e.data.length,this.syncStats.lastSync=Date.now(),this.updateBandwidth(e.data.length),this.notifyListeners("dataReceived",t)}catch(t){}}}startDiscoveryLoop(){this.discoveryInterval=setInterval((async()=>{const e=(0,I.JU)(C.db,"mesh_peers",this.deviceId);await(0,I.pl)(e,{lastSeen:Date.now(),available:!0},{merge:!0}),this.peers.forEach(((e,t)=>{Date.now()-e.lastSeen>6e4&&(this.peers.delete(t),this.disconnectPeer(t))}))}),this.config.heartbeatInterval)}updatePeerStatus(e,t){const s=this.peers.get(e);s&&(s.status=t,s.lastSeen=Date.now(),this.notifyListeners("peerStatusChanged",s))}updateBandwidth(e){const t=Date.now();!this.syncStats.lastSync||t-this.syncStats.lastSync>1e4?this.syncStats.bandwidth=e/10:this.syncStats.bandwidth=.9*this.syncStats.bandwidth+.1*e}notifyListeners(e,t){const s=this.listeners.get(e);s&&s.forEach((e=>{try{e(t)}catch(s){}}))}generatePacketId(){return"pkt_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}getDeviceName(){return"".concat(navigator.platform," Browser")}constructor(){this.peers=new Map,this.connections=new Map,this.dataChannels=new Map,this.unsubscribers=[],this.discoveryInterval=null,this.deviceId="",this.userId="",this.config={maxPeers:5,discoveryTimeout:3e4,connectionTimeout:15e3,heartbeatInterval:1e4,retryAttempts:3},this.syncStats={peersConnected:0,totalDataSynced:0,conflicts:0,lastSync:null,bandwidth:0},this.listeners=new Map,this.pendingOffers=new Map,this.pendingAnswers=new Map}};var _,A;!function(e){e.CREATE="CREATE",e.UPDATE="UPDATE",e.DELETE="DELETE"}(_||(_={})),function(e){e.PENDING="PENDING",e.PROCESSING="PROCESSING",e.COMPLETED="COMPLETED",e.FAILED="FAILED",e.CONFLICT="CONFLICT"}(A||(A={}));const R=new class{async initialize(){if(!this.db)return new Promise(((e,t)=>{const s=indexedDB.open(this.DB_NAME,this.DB_VERSION);s.onerror=()=>{t(s.error)},s.onsuccess=()=>{this.db=s.result,this.startRetryLoop(),e()},s.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains(this.STORE_NAME)){const e=t.createObjectStore(this.STORE_NAME,{keyPath:"id"});e.createIndex("status","status",{unique:!1}),e.createIndex("collection","collection",{unique:!1}),e.createIndex("createdAt","createdAt",{unique:!1}),e.createIndex("documentId","documentId",{unique:!1})}}}))}async enqueue(e,t,s,n){if(!this.db)throw new Error("Database not initialized");const a={id:this.generateId(),type:e,collection:t,documentId:s,data:n,status:"PENDING",attempts:0,maxAttempts:3,createdAt:Date.now(),updatedAt:Date.now(),version:1};return new Promise(((e,t)=>{const s=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).add(a);s.onsuccess=()=>{this.notifyListeners("operationAdded",a),e(a.id),this.processQueue().catch(console.error)},s.onerror=()=>{t(s.error)}}))}async getOperation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME).get(e);n.onsuccess=()=>{t(n.result||null)},n.onerror=()=>{s(n.error)}}))}async getOperations(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction([this.STORE_NAME],"readonly").objectStore(this.STORE_NAME);let a;if(e){const t=n.index("status");a=t.getAll(e)}else a=n.getAll();a.onsuccess=()=>{t(a.result)},a.onerror=()=>{s(a.error)}}))}async getStats(){return(await this.getOperations()).reduce(((e,t)=>{switch(t.status){case"PENDING":e.pending++;break;case"PROCESSING":e.processing++;break;case"COMPLETED":e.completed++;break;case"FAILED":e.failed++;break;case"CONFLICT":e.conflicts++}return e}),{pending:0,processing:0,completed:0,failed:0,conflicts:0})}async processQueue(){if(!this.isProcessing&&this.db){this.isProcessing=!0;try{const t=await this.getOperations("PENDING");for(const s of t)try{await this.processOperation(s)}catch(e){}}finally{this.isProcessing=!1}}}async retryFailed(){if(!this.db)throw new Error("Database not initialized");const e=await this.getOperations("FAILED");for(const t of e)t.attempts<t.maxAttempts&&await this.updateOperation(t.id,{status:"PENDING",attempts:t.attempts+1,updatedAt:Date.now()});await this.processQueue()}async resolveConflict(e){const t=await this.getOperation(e.operationId);if(!t)throw new Error("Operation not found");if("CONFLICT"!==t.status)throw new Error("Operation is not in conflict state");switch(e.strategy){case"local":await this.updateOperation(t.id,{status:"PENDING",updatedAt:Date.now()}),await this.processQueue();break;case"remote":await this.updateOperation(t.id,{status:"COMPLETED",updatedAt:Date.now()});break;case"merge":if(!e.resolvedData)throw new Error("Resolved data required for merge strategy");await this.updateOperation(t.id,{data:e.resolvedData,status:"PENDING",updatedAt:Date.now()}),await this.processQueue()}this.notifyListeners("conflictResolved",{operation:t,resolution:e})}async clearCompleted(){if(!this.db)throw new Error("Database not initialized");const e=await this.getOperations("COMPLETED");let t=0;for(const s of e)await this.deleteOperation(s.id),t++;return t}async clearAll(){if(!this.db)throw new Error("Database not initialized");return new Promise(((e,t)=>{const s=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).clear();s.onsuccess=()=>{this.notifyListeners("queueCleared",null),e()},s.onerror=()=>{t(s.error)}}))}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{const s=this.listeners.get(e);s&&s.delete(t)}}shutdown(){this.retryInterval&&(clearInterval(this.retryInterval),this.retryInterval=null),this.db&&(this.db.close(),this.db=null),this.listeners.clear()}async processOperation(e){await this.updateOperation(e.id,{status:"PROCESSING",updatedAt:Date.now()});try{if(await this.checkForConflicts(e))return await this.updateOperation(e.id,{status:"CONFLICT",error:"Version conflict detected",updatedAt:Date.now()}),void this.notifyListeners("conflict",e);await this.executeOperation(e),await this.updateOperation(e.id,{status:"COMPLETED",updatedAt:Date.now()}),this.notifyListeners("operationCompleted",e)}catch(t){const s=e.attempts+1,n=s>=e.maxAttempts?"FAILED":"PENDING";await this.updateOperation(e.id,{status:n,attempts:s,error:t.message||"Unknown error",updatedAt:Date.now()}),"FAILED"===n&&this.notifyListeners("operationFailed",e)}}async executeOperation(e){await new Promise((e=>setTimeout(e,100)))}async checkForConflicts(e){return!1}async updateOperation(e,t){if(!this.db)throw new Error("Database not initialized");return new Promise(((s,n)=>{const a=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME),i=a.get(e);i.onsuccess=()=>{const e=i.result;if(e){const i={...e,...t},r=a.put(i);r.onsuccess=()=>{this.notifyListeners("operationUpdated",i),s()},r.onerror=()=>{n(r.error)}}else n(new Error("Operation not found"))},i.onerror=()=>{n(i.error)}}))}async deleteOperation(e){if(!this.db)throw new Error("Database not initialized");return new Promise(((t,s)=>{const n=this.db.transaction([this.STORE_NAME],"readwrite").objectStore(this.STORE_NAME).delete(e);n.onsuccess=()=>{t()},n.onerror=()=>{s(n.error)}}))}startRetryLoop(){this.retryInterval=setInterval((()=>{this.processQueue().catch(console.error)}),3e4)}notifyListeners(e,t){const s=this.listeners.get(e);s&&s.forEach((e=>{try{e(t)}catch(s){}}))}generateId(){return"op_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}constructor(){this.db=null,this.DB_NAME="SalatisoOfflineQueue",this.DB_VERSION=1,this.STORE_NAME="operations",this.isProcessing=!1,this.listeners=new Map,this.retryInterval=null}};var M=s(60493),L=s(44976),k=s(89176),U=s(89354),G=s(24420),F=s(52217);const Z=()=>{const[e,t]=(0,a.useState)(S.DISCONNECTED),[s,i]=(0,a.useState)([]),[r,c]=(0,a.useState)(null),[o,d]=(0,a.useState)([]),[m,g]=(0,a.useState)(null),[x,y]=(0,a.useState)(null),[f,N]=(0,a.useState)(!1);(0,a.useEffect)((()=>{const e=O.on("statusChanged",(e=>{t(e)})),s=O.on("devicesUpdated",(e=>{i(e)})),n=O.on("syncProgress",(e=>{c(e)})),a=P.on("peerDiscovered",(()=>{d(P.getPeers())})),r=P.on("statsUpdated",(e=>{g(e)})),o=R.on("operationUpdated",(async()=>{const e=await R.getStats();y(e)}));return(async()=>{try{await R.initialize();const e=await R.getStats();y(e),N(!0)}catch(e){}})(),t(O.getStatus()),i(O.getConnectedDevices()),d(P.getPeers()),g(P.getStats()),()=>{e(),s(),n(),a(),r(),o()}}),[]);const b=e=>{switch(e){case T.CONNECTED:return"bg-green-500";case T.CONNECTING:case T.DISCOVERING:return"bg-yellow-500";case T.ERROR:return"bg-red-500";default:return"bg-gray-500"}},w=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,t)*100)/100+" "+["B","KB","MB","GB"][t]},v=e=>{if(!e)return"Never";const t=Date.now()-e;return t<6e4?"Just now":t<36e5?"".concat(Math.floor(t/6e4),"m ago"):t<864e5?"".concat(Math.floor(t/36e5),"h ago"):"".concat(Math.floor(t/864e5),"d ago")};return(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"p-3 rounded-full ".concat((e=>{switch(e){case S.CONNECTED:return"text-green-600 bg-green-50";case S.CONNECTING:case S.SYNCING:return"text-yellow-600 bg-yellow-50";case S.ERROR:return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}})(e)),children:(e=>{switch(e){case S.CONNECTED:return(0,n.jsx)(M.Z,{className:"h-5 w-5"});case S.CONNECTING:case S.SYNCING:return(0,n.jsx)(L.Z,{className:"h-5 w-5 animate-spin"});case S.ERROR:return(0,n.jsx)(u.Z,{className:"h-5 w-5"});default:return(0,n.jsx)(h.Z,{className:"h-5 w-5"})}})(e)}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold",children:"Mobile Bridge Status"}),(0,n.jsx)("p",{className:"text-sm text-gray-600",children:"Sonny Android App Connection"})]})]}),(0,n.jsxs)("button",{onClick:async()=>{try{await O.requestSync(["incidents","escalations","projects","contacts"])}catch(e){}},disabled:e!==S.CONNECTED,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed flex items-center space-x-2",children:[(0,n.jsx)(L.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:"Sync Now"})]})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600 mb-1",children:[(0,n.jsx)(k.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Connected Devices"})]}),(0,n.jsx)("p",{className:"text-2xl font-bold",children:s.length})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600 mb-1",children:[(0,n.jsx)(l.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Last Sync"})]}),(0,n.jsx)("p",{className:"text-2xl font-bold",children:v((null===r||void 0===r?void 0:r.lastSync)||null)})]}),(0,n.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2 text-gray-600 mb-1",children:[(0,n.jsx)(U.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"text-sm font-medium",children:"Status"})]}),(0,n.jsx)("p",{className:"text-2xl font-bold",children:e})]})]}),r&&r.inProgress>0&&(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsxs)("div",{className:"flex justify-between text-sm mb-2",children:[(0,n.jsx)("span",{children:"Syncing..."}),(0,n.jsxs)("span",{children:[r.completed," / ",r.total]})]}),(0,n.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"".concat(r.completed/r.total*100,"%")}})})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[(0,n.jsx)(G.Z,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:"Connected Devices"})]}),0===s.length?(0,n.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,n.jsx)(G.Z,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),(0,n.jsx)("p",{children:"No devices connected"}),(0,n.jsx)("p",{className:"text-sm",children:"Open Sonny app to connect"})]}):(0,n.jsx)("div",{className:"space-y-3",children:s.map((e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)(G.Z,{className:"h-5 w-5 text-gray-600"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium",children:e.name}),(0,n.jsxs)("p",{className:"text-xs text-gray-600",children:[e.type," \u2022 v",e.version," \u2022 ",v(e.lastSeen)]})]})]}),(0,n.jsx)("span",{className:"px-2 py-1 text-xs rounded-full ".concat("online"===e.status?"bg-green-100 text-green-800":"syncing"===e.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:e.status})]},e.id)))})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center space-x-2",children:[(0,n.jsx)(p.Z,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:"Mesh Network"})]}),m&&(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3",children:[(0,n.jsx)("p",{className:"text-xs text-blue-600 mb-1",children:"Peers"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:m.peersConnected})]}),(0,n.jsxs)("div",{className:"bg-green-50 rounded-lg p-3",children:[(0,n.jsx)("p",{className:"text-xs text-green-600 mb-1",children:"Data Synced"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-green-600",children:w(m.totalDataSynced)})]}),(0,n.jsxs)("div",{className:"bg-purple-50 rounded-lg p-3",children:[(0,n.jsx)("p",{className:"text-xs text-purple-600 mb-1",children:"Bandwidth"}),(0,n.jsxs)("p",{className:"text-2xl font-bold text-purple-600",children:[w(m.bandwidth),"/s"]})]}),(0,n.jsxs)("div",{className:"bg-orange-50 rounded-lg p-3",children:[(0,n.jsx)("p",{className:"text-xs text-orange-600 mb-1",children:"Conflicts"}),(0,n.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:m.conflicts})]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[o.map((e=>(0,n.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"w-2 h-2 rounded-full ".concat(b(e.status))}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"font-medium text-sm",children:e.name}),(0,n.jsxs)("p",{className:"text-xs text-gray-600",children:[e.type," \u2022 ",e.latency,"ms \u2022 ",w(e.dataSize)]})]})]}),(0,n.jsx)("span",{className:"text-xs text-gray-600",children:e.status})]},e.id))),0===o.length&&(0,n.jsx)("p",{className:"text-center text-gray-500 py-4",children:"No mesh peers discovered"})]})]}),(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("h3",{className:"text-lg font-semibold flex items-center space-x-2",children:[(0,n.jsx)(F.Z,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:"Offline Queue"})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)("button",{onClick:async()=>{try{await R.retryFailed()}catch(e){}},disabled:!x||0===x.failed,className:"px-3 py-1 text-sm bg-yellow-600 text-white rounded hover:bg-yellow-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Retry Failed"}),(0,n.jsx)("button",{onClick:async()=>{try{await R.clearCompleted();const e=await R.getStats();y(e)}catch(e){}},disabled:!x||0===x.completed,className:"px-3 py-1 text-sm bg-green-600 text-white rounded hover:bg-green-700 disabled:bg-gray-300 disabled:cursor-not-allowed",children:"Clear Completed"})]})]}),x?(0,n.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-3",children:[(0,n.jsxs)("div",{className:"bg-yellow-50 rounded-lg p-3 text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:x.pending}),(0,n.jsx)("p",{className:"text-xs text-yellow-600",children:"Pending"})]}),(0,n.jsxs)("div",{className:"bg-blue-50 rounded-lg p-3 text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:x.processing}),(0,n.jsx)("p",{className:"text-xs text-blue-600",children:"Processing"})]}),(0,n.jsxs)("div",{className:"bg-green-50 rounded-lg p-3 text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-green-600",children:x.completed}),(0,n.jsx)("p",{className:"text-xs text-green-600",children:"Completed"})]}),(0,n.jsxs)("div",{className:"bg-red-50 rounded-lg p-3 text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-red-600",children:x.failed}),(0,n.jsx)("p",{className:"text-xs text-red-600",children:"Failed"})]}),(0,n.jsxs)("div",{className:"bg-orange-50 rounded-lg p-3 text-center",children:[(0,n.jsx)("p",{className:"text-2xl font-bold text-orange-600",children:x.conflicts}),(0,n.jsx)("p",{className:"text-xs text-orange-600",children:"Conflicts"})]})]}):(0,n.jsx)("p",{className:"text-center text-gray-500 py-4",children:"Initializing queue..."})]})]})};var Q=s(60837),z=s(93517);var q=()=>{const{user:e}=(0,Q.a)(),[t,s]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{if(null===e||void 0===e?void 0:e.id){return(async()=>{try{await O.initialize(e.id);const t=localStorage.getItem("deviceId")||"web_".concat(Date.now());await P.initialize(e.id,t),s(!0)}catch(t){}})(),()=>{O.disconnect(),P.shutdown()}}}),[e]),(0,n.jsx)(g,{children:(0,n.jsxs)(c.Z,{children:[(0,n.jsxs)(r(),{children:[(0,n.jsx)("title",{children:"Sync Control - Salatiso Ecosystem"}),(0,n.jsx)("meta",{name:"description",content:"Real-time sync engine with mesh networking, delta sync, and mobile bridge"})]}),(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Sync Control Center"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Manage sync operations, mobile connections, and mesh networking"})]}),(0,n.jsxs)(z.mQ,{defaultValue:"sync-engine",className:"w-full",children:[(0,n.jsxs)(z.dr,{className:"grid w-full grid-cols-2",children:[(0,n.jsx)(z.SP,{value:"sync-engine",children:"Sync Engine"}),(0,n.jsx)(z.SP,{value:"mobile-bridge",children:"Mobile Bridge"})]}),(0,n.jsx)(z.nU,{value:"sync-engine",className:"mt-6",children:(0,n.jsx)(E,{})}),(0,n.jsx)(z.nU,{value:"mobile-bridge",className:"mt-6",children:t?(0,n.jsx)(Z,{}):(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-12 text-center",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Initializing mobile bridge services..."})]})})]})]})]})})}}},function(e){e.O(0,[4179,5047,2888,9774,179],(function(){return t=30846,e(e.s=t);var t}));var t=e.O();_N_E=t}]);