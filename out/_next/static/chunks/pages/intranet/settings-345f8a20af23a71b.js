(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8648,9616],{76567:function(e,i,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/intranet/settings",function(){return a(18093)}])},18093:function(e,i,a){"use strict";a.r(i),a.d(i,{default:function(){return T}});var n=a(85893),t=a(67294),l=a(35047),o=a(60837),s=a(89616);const r=()=>{const{user:e,updateUserProfile:i}=(0,o.a)(),[a,n]=(0,t.useState)("default"),[l,r]=(0,t.useState)(!1),d=!0,c=s.default.isSupported(),u=(0,t.useCallback)((()=>{{const e=s.default.getPermissionStatus();n(e)}}),[d]);(0,t.useEffect)((()=>{c&&(u(),"permissions"in navigator&&navigator.permissions.query({name:"notifications"}).then((e=>(e.addEventListener("change",u),()=>e.removeEventListener("change",u)))))}),[d,c,u]),(0,t.useEffect)((()=>{var i;(null===e||void 0===e||null===(i=e.preferences)||void 0===i?void 0:i.notifications)&&r(e.preferences.notifications.push&&"granted"===a)}),[e,a]);const v=(0,t.useCallback)((async()=>{try{const e=await s.default.requestPermission();return n(e),e}catch(e){return"denied"}}),[]),m=(0,t.useCallback)((async()=>{try{var a,n,t,l,o,d,c,u,m,h,p,f;if("granted"!==await v())throw new Error("Notification permission denied");const C=await s.default.getFCMToken();if(!C)throw new Error("Failed to get FCM token");var g,x,y,b,j,w,N,k;(null===e||void 0===e?void 0:e.id)&&await s.default.saveTokenToUser(e.id,C),await i({preferences:{theme:null!==(g=null===e||void 0===e||null===(a=e.preferences)||void 0===a?void 0:a.theme)&&void 0!==g?g:"light",language:null!==(x=null===e||void 0===e||null===(n=e.preferences)||void 0===n?void 0:n.language)&&void 0!==x?x:"en",notifications:{email:null===(y=null===e||void 0===e||null===(l=e.preferences)||void 0===l||null===(t=l.notifications)||void 0===t?void 0:t.email)||void 0===y||y,push:!0,projectUpdates:null===(b=null===e||void 0===e||null===(d=e.preferences)||void 0===d||null===(o=d.notifications)||void 0===o?void 0:o.projectUpdates)||void 0===b||b,careerMilestones:null===(j=null===e||void 0===e||null===(u=e.preferences)||void 0===u||null===(c=u.notifications)||void 0===c?void 0:c.careerMilestones)||void 0===j||j,familyAnnouncements:null===(w=null===e||void 0===e||null===(h=e.preferences)||void 0===h||null===(m=h.notifications)||void 0===m?void 0:m.familyAnnouncements)||void 0===w||w},dashboardLayout:null!==(N=null===e||void 0===e||null===(p=e.preferences)||void 0===p?void 0:p.dashboardLayout)&&void 0!==N?N:[],gamificationEnabled:null===(k=null===e||void 0===e||null===(f=e.preferences)||void 0===f?void 0:f.gamificationEnabled)||void 0===k||k}}),s.default.initializeForegroundMessages(),r(!0)}catch(C){throw C}}),[e,v,i]),h=(0,t.useCallback)((async()=>{try{var a,n,t,l,o,d,c,u,v,m,h,p,f,g,x,y,b,j,w,N;(null===e||void 0===e?void 0:e.id)&&await s.default.removeTokenFromUser(e.id),await i({preferences:{theme:null!==(f=null===e||void 0===e||null===(a=e.preferences)||void 0===a?void 0:a.theme)&&void 0!==f?f:"light",language:null!==(g=null===e||void 0===e||null===(n=e.preferences)||void 0===n?void 0:n.language)&&void 0!==g?g:"en",notifications:{email:null===(x=null===e||void 0===e||null===(l=e.preferences)||void 0===l||null===(t=l.notifications)||void 0===t?void 0:t.email)||void 0===x||x,push:!1,projectUpdates:null===(y=null===e||void 0===e||null===(d=e.preferences)||void 0===d||null===(o=d.notifications)||void 0===o?void 0:o.projectUpdates)||void 0===y||y,careerMilestones:null===(b=null===e||void 0===e||null===(u=e.preferences)||void 0===u||null===(c=u.notifications)||void 0===c?void 0:c.careerMilestones)||void 0===b||b,familyAnnouncements:null===(j=null===e||void 0===e||null===(m=e.preferences)||void 0===m||null===(v=m.notifications)||void 0===v?void 0:v.familyAnnouncements)||void 0===j||j},dashboardLayout:null!==(w=null===e||void 0===e||null===(h=e.preferences)||void 0===h?void 0:h.dashboardLayout)&&void 0!==w?w:[],gamificationEnabled:null===(N=null===e||void 0===e||null===(p=e.preferences)||void 0===p?void 0:p.gamificationEnabled)||void 0===N||N}}),r(!1)}catch(k){throw k}}),[e,i]),p=(0,t.useCallback)((async()=>{if(!(null===e||void 0===e?void 0:e.id))throw new Error("User not authenticated");try{await s.default.sendTestNotification(e.id)}catch(i){throw i}}),[e]),f=(0,t.useCallback)((async()=>{var i,n;if(c&&(null===e||void 0===e||null===(n=e.preferences)||void 0===n||null===(i=n.notifications)||void 0===i?void 0:i.push))try{if("granted"===a){const i=await s.default.getFCMToken();i&&e.id&&await s.default.saveTokenToUser(e.id,i),s.default.initializeForegroundMessages()}}catch(t){}}),[c,e,a]);return{isSupported:c,permission:a,isEnabled:l,requestPermission:v,enableNotifications:m,disableNotifications:h,sendTestNotification:p,initialize:f}};var d=a(12002),c=a(64970),u=a.n(c),v=a(78865),m=a(62190),h=a(43283),p=a(90341),f=a(68760);var g=e=>{let{currentPhotoURL:i,onUpload:a,onWebcamCapture:l}=e;const[o,s]=(0,t.useState)(i||null),[r,c]=(0,t.useState)(!1),[g,x]=(0,t.useState)(!1),y=(0,t.useRef)(null),b=(0,t.useCallback)((async e=>{if(0===e.length)return;const i=e[0];if(i.size>5242880)return void alert("File size must be less than 5MB");if(!i.type.startsWith("image/"))return void alert("Please upload an image file (JPG, PNG, or GIF)");const n=new FileReader;n.onload=e=>{var i;s(null===(i=e.target)||void 0===i?void 0:i.result)},n.readAsDataURL(i),x(!0);try{await a(i)}catch(t){alert("Failed to upload image. Please try again.")}finally{x(!1)}}),[a]),{getRootProps:j,getInputProps:w,isDragActive:N}=(0,d.uI)({onDrop:b,accept:{"image/*":[".jpeg",".jpg",".png",".gif"]},maxFiles:1,disabled:g}),k=(0,t.useCallback)((async()=>{if(!y.current)return;const e=y.current.getScreenshot();if(e){s(e),c(!1),x(!0);try{await l(e)}catch(i){alert("Failed to save captured photo. Please try again.")}finally{x(!1)}}}),[l]);return(0,n.jsxs)("div",{className:"space-y-4",children:[o&&!r&&(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("img",{src:o,alt:"Profile preview",className:"w-32 h-32 rounded-full object-cover mx-auto border-4 border-gray-200"}),g&&(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 rounded-full",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-white"})})]}),r&&(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)(u(),{ref:y,audio:!1,screenshotFormat:"image/jpeg",className:"w-full rounded-lg",videoConstraints:{width:1280,height:720,facingMode:"user"}}),(0,n.jsxs)("div",{className:"flex justify-center space-x-4 mt-4",children:[(0,n.jsxs)("button",{onClick:k,disabled:g,className:"flex items-center space-x-2 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 disabled:opacity-50",children:[(0,n.jsx)(v.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:"Capture Photo"})]}),(0,n.jsxs)("button",{onClick:()=>c(!1),className:"flex items-center space-x-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700",children:[(0,n.jsx)(m.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:"Cancel"})]})]})]}),!r&&(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{...j(),className:"border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors ".concat(N?"border-primary-500 bg-primary-50":"border-gray-300 hover:border-primary-400 hover:bg-gray-50"," ").concat(g?"opacity-50 cursor-not-allowed":""),children:[(0,n.jsx)("input",{...w()}),(0,n.jsx)(h.Z,{className:"h-8 w-8 mx-auto mb-2 text-gray-400"}),N?(0,n.jsx)("p",{className:"text-sm text-primary-600 font-medium",children:"Drop your photo here..."}):(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-gray-600 font-medium mb-1",children:"Drag & drop your photo here, or click to browse"}),(0,n.jsx)("p",{className:"text-xs text-gray-500",children:"JPG, PNG or GIF \u2022 Max 5MB"})]})]}),(0,n.jsxs)("button",{onClick:()=>c(!0),disabled:g,className:"w-full flex items-center justify-center space-x-2 px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-primary-400 hover:bg-gray-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(p.Z,{className:"h-5 w-5 text-gray-600"}),(0,n.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Take Photo with Webcam"})]}),(0,n.jsxs)("label",{className:"w-full flex items-center justify-center space-x-2 px-4 py-3 border-2 border-gray-300 rounded-lg hover:border-primary-400 hover:bg-gray-50 transition-colors cursor-pointer",children:[(0,n.jsx)(f.Z,{className:"h-5 w-5 text-gray-600"}),(0,n.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Upload from Phone Camera"}),(0,n.jsx)("input",{type:"file",accept:"image/*",capture:"user",onChange:e=>{e.target.files&&e.target.files[0]&&b([e.target.files[0]])},className:"hidden",disabled:g})]})]}),g&&(0,n.jsx)("div",{className:"text-center",children:(0,n.jsxs)("div",{className:"inline-flex items-center space-x-2 text-sm text-primary-600",children:[(0,n.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-primary-600"}),(0,n.jsx)("span",{children:"Uploading..."})]})})]})},x=a(16689),y=a(97042);const b=(0,x.cF)();var j=a(8267),w=a(73416),N=a(77918),k=a(42020),C=a(1781),P=a(23346),S=a(69819),U=a(72577);var T=()=>{var e,i,a,s,d,c,u,v,m,h,f,T,E,A,M;const{user:F,updateUserProfile:L}=(0,o.a)(),{isSupported:D,permission:I,isEnabled:_,requestPermission:Y,enableNotifications:Z,disableNotifications:R,sendTestNotification:X}=r(),[G,B]=(0,t.useState)("profile"),[q,W]=(0,t.useState)(!1),[J,z]=(0,t.useState)(""),[K,V]=(0,t.useState)(!1),[H,O]=(0,t.useState)((null===F||void 0===F?void 0:F.displayName)||""),[Q,$]=(0,t.useState)(""),[ee,ie]=(0,t.useState)(""),[ae,ne]=(0,t.useState)(""),te=[{id:"profile",label:"Profile",icon:j.Z},{id:"privacy",label:"Privacy",icon:w.Z},{id:"notifications",label:"Notifications",icon:N.Z},{id:"language",label:"Language",icon:k.Z},{id:"gamification",label:"Gamification",icon:C.Z}];var le,oe,se,re;return(0,n.jsx)(l.Z,{title:"Settings",children:(0,n.jsxs)("div",{className:"p-4 lg:p-8 max-w-6xl mx-auto",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Settings"}),(0,n.jsx)("p",{className:"text-gray-600",children:"Manage your profile, preferences, and privacy settings"})]}),J&&(0,n.jsx)("div",{className:"mb-6 bg-green-50 border border-green-200 text-green-800 px-4 py-3 rounded-lg",children:J}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,n.jsx)("div",{className:"lg:col-span-1",children:(0,n.jsx)("nav",{className:"space-y-1 bg-white rounded-lg shadow-sm border border-gray-200 p-2",children:te.map((e=>{const i=e.icon;return(0,n.jsxs)("button",{onClick:()=>B(e.id),className:"w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-left transition-colors ".concat(G===e.id?"bg-primary-50 text-primary-700 font-medium":"text-gray-700 hover:bg-gray-50"),children:[(0,n.jsx)(i,{className:"h-5 w-5"}),(0,n.jsx)("span",{children:e.label})]},e.id)}))})}),(0,n.jsx)("div",{className:"lg:col-span-3",children:(0,n.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-6",children:["profile"===G&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Profile Information"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Update your personal information and how others see you in the family intranet."})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-6",children:[(0,n.jsx)("div",{className:"relative",children:(null===F||void 0===F?void 0:F.photoURL)?(0,n.jsx)("img",{src:F.photoURL,alt:F.displayName||"Profile",className:"h-24 w-24 rounded-full object-cover border-4 border-gray-200"}):(0,n.jsx)("div",{className:"h-24 w-24 rounded-full bg-primary-100 flex items-center justify-center border-4 border-gray-200",children:(0,n.jsx)(j.Z,{className:"h-12 w-12 text-primary-600"})})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-medium text-gray-900 mb-1",children:(null===F||void 0===F?void 0:F.displayName)||"Family Member"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-2",children:null===F||void 0===F?void 0:F.email}),(0,n.jsxs)("button",{onClick:()=>V(!K),className:"text-sm text-primary-600 hover:text-primary-700 font-medium flex items-center space-x-1",children:[(0,n.jsx)(p.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:K?"Close uploader":"Change photo"})]}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"JPG, PNG or GIF. Max 5MB."})]})]}),K&&(0,n.jsx)("div",{className:"p-4 bg-gray-50 rounded-lg border border-gray-200",children:(0,n.jsx)(g,{currentPhotoURL:null===F||void 0===F?void 0:F.photoURL,onUpload:async e=>{try{const i=await(async e=>{if(!y.I8.currentUser)throw new Error("User must be authenticated to upload profile picture");const i=y.I8.currentUser.uid,a=e.name.split(".").pop(),n="avatar.".concat(a),t=(0,x.iH)(b,"profiles/".concat(i,"/").concat(n));return await(0,x.KV)(t,e),await(0,x.Jt)(t)})(e);await L({photoURL:i}),z("Profile picture updated successfully!"),V(!1),setTimeout((()=>z("")),3e3)}catch(i){throw i}},onWebcamCapture:async e=>{try{const i=await(async e=>{if(!y.I8.currentUser)throw new Error("User must be authenticated to upload profile picture");const i=await fetch(e),a=await i.blob(),n=y.I8.currentUser.uid,t=(0,x.iH)(b,"profiles/".concat(n,"/").concat("avatar-webcam.jpg"));return await(0,x.KV)(t,a),await(0,x.Jt)(t)})(e);await L({photoURL:i}),z("Profile picture updated successfully!"),V(!1),setTimeout((()=>z("")),3e3)}catch(i){throw i}}})})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(U.Pg,{label:"Display Name",type:"text",value:H,onChange:e=>O(e.target.value),placeholder:"Your name"}),(0,n.jsx)(U.eP,{label:"Bio",value:Q,onChange:e=>$(e.target.value),rows:4,placeholder:"Tell your family about yourself...",hint:"Brief description for your profile. Maximum 500 characters."}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,n.jsx)(U.Pg,{label:"Phone Number",type:"tel",value:ee,onChange:e=>ie(e.target.value),placeholder:"+27 XX XXX XXXX"}),(0,n.jsx)(U.Pg,{label:"Location",type:"text",value:ae,onChange:e=>ne(e.target.value),placeholder:"Cape Town, South Africa"})]}),(0,n.jsxs)("div",{className:"space-y-4 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,n.jsxs)("h3",{className:"font-semibold text-gray-900 flex items-center gap-2",children:[(0,n.jsx)(P.Z,{className:"h-5 w-5 text-blue-600"}),"Important Dates"]}),(0,n.jsx)(U.Pg,{label:"Date of Birth",type:"date",value:(null===F||void 0===F?void 0:F.birthday)||"",onChange:async e=>{try{await L({birthday:e.target.value})}catch(i){}},hint:"Your full birth date for family records and celebrations"}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Anniversaries"}),(0,n.jsxs)("div",{className:"space-y-2",children:[null===F||void 0===F||null===(e=F.anniversaries)||void 0===e?void 0:e.map(((e,i)=>(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsx)("input",{type:"text",value:e.name,placeholder:"e.g., Wedding Anniversary",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",onChange:a=>{const n=[...F.anniversaries||[]];n[i]={...e,name:a.target.value},L({anniversaries:n})}}),(0,n.jsx)("input",{type:"date",value:e.date,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",onChange:a=>{const n=[...F.anniversaries||[]];n[i]={...e,date:a.target.value},L({anniversaries:n})}})]},e.id))),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,n.jsx)("input",{type:"text",placeholder:"e.g., Wedding Anniversary",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",onChange:e=>{const i={id:Date.now().toString(),name:e.target.value,date:"",createdAt:new Date};L({anniversaries:[...(null===F||void 0===F?void 0:F.anniversaries)||[],i]})}}),(0,n.jsx)("input",{type:"date",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent",onChange:e=>{const i={id:Date.now().toString(),name:"",date:e.target.value,createdAt:new Date};L({anniversaries:[...(null===F||void 0===F?void 0:F.anniversaries)||[],i]})}})]}),(0,n.jsx)("button",{className:"text-sm text-primary-600 hover:text-primary-700 font-medium",children:"+ Add Another Anniversary"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Role in Family"}),(0,n.jsx)("input",{type:"text",value:(null===F||void 0===F?void 0:F.role)||"",disabled:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-50 text-gray-600",placeholder:"Your role"}),(0,n.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Contact an admin to change your role."})]})]}),(0,n.jsx)("div",{className:"flex justify-end pt-4 border-t border-gray-200",children:(0,n.jsxs)("button",{onClick:async()=>{W(!0);try{await L({displayName:H}),z("Profile updated successfully!"),setTimeout((()=>z("")),3e3)}catch(e){}finally{W(!1)}},disabled:q,className:"flex items-center space-x-2 bg-primary-600 text-white px-6 py-2 rounded-lg hover:bg-primary-700 disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,n.jsx)(S.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{children:q?"Saving...":"Save Changes"})]})})]}),"privacy"===G&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Privacy Settings"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Control what information is visible to other family members."})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(U.dN,{label:"Show profile to family",hint:"Allow family members to see your profile",defaultChecked:!0}),(0,n.jsx)(U.dN,{label:"Show contact information",hint:"Display your phone and email to family",defaultChecked:!0}),(0,n.jsx)(U.dN,{label:"Show activity status",hint:"Let others see when you're online",defaultChecked:!0}),(0,n.jsx)(U.dN,{label:"Share achievements",hint:"Show your badges and accomplishments",defaultChecked:!0})]})]}),"notifications"===G&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Notification Preferences"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Choose how you want to be notified about family updates."})]}),D&&(0,n.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg",children:(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h3",{className:"font-medium text-gray-900",children:"Push Notifications"}),(0,n.jsxs)("p",{className:"text-sm text-gray-600",children:["Receive instant notifications in your browser","denied"===I&&(0,n.jsx)("span",{className:"text-red-600 ml-1",children:"(Permission denied - check browser settings)"})]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("input",{type:"checkbox",checked:_,onChange:async e=>{try{e.target.checked?await Z():await R()}catch(i){}},className:"h-5 w-5 text-primary-600"}),_&&(0,n.jsx)("button",{onClick:async()=>{try{await X()}catch(e){}},className:"px-3 py-1 text-sm bg-primary-600 text-white rounded hover:bg-primary-700",children:"Test"})]})]})}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(U.dN,{label:"Email notifications",hint:"Receive updates via email",checked:null===(le=null===F||void 0===F||null===(a=F.preferences)||void 0===a||null===(i=a.notifications)||void 0===i?void 0:i.email)||void 0===le||le,onChange:async e=>{try{var i,a,n,t,l,o,s,r,d,c,u,v,m,h,p,f,g,x,y,b;await L({preferences:{theme:null!==(m=null===F||void 0===F||null===(i=F.preferences)||void 0===i?void 0:i.theme)&&void 0!==m?m:"light",language:null!==(h=null===F||void 0===F||null===(a=F.preferences)||void 0===a?void 0:a.language)&&void 0!==h?h:"en",notifications:{email:e.target.checked,push:null!==(p=null===F||void 0===F||null===(t=F.preferences)||void 0===t||null===(n=t.notifications)||void 0===n?void 0:n.push)&&void 0!==p&&p,projectUpdates:null===(f=null===F||void 0===F||null===(o=F.preferences)||void 0===o||null===(l=o.notifications)||void 0===l?void 0:l.projectUpdates)||void 0===f||f,careerMilestones:null===(g=null===F||void 0===F||null===(r=F.preferences)||void 0===r||null===(s=r.notifications)||void 0===s?void 0:s.careerMilestones)||void 0===g||g,familyAnnouncements:null===(x=null===F||void 0===F||null===(c=F.preferences)||void 0===c||null===(d=c.notifications)||void 0===d?void 0:d.familyAnnouncements)||void 0===x||x},dashboardLayout:null!==(y=null===F||void 0===F||null===(u=F.preferences)||void 0===u?void 0:u.dashboardLayout)&&void 0!==y?y:[],gamificationEnabled:null===(b=null===F||void 0===F||null===(v=F.preferences)||void 0===v?void 0:v.gamificationEnabled)||void 0===b||b}})}catch(j){}}}),(0,n.jsx)(U.dN,{label:"Project updates",hint:"Get notified about project changes",checked:null===(oe=null===F||void 0===F||null===(d=F.preferences)||void 0===d||null===(s=d.notifications)||void 0===s?void 0:s.projectUpdates)||void 0===oe||oe,onChange:async e=>{try{var i,a,n,t,l,o,s,r,d,c,u,v,m,h,p,f,g,x,y,b;await L({preferences:{theme:null!==(m=null===F||void 0===F||null===(i=F.preferences)||void 0===i?void 0:i.theme)&&void 0!==m?m:"light",language:null!==(h=null===F||void 0===F||null===(a=F.preferences)||void 0===a?void 0:a.language)&&void 0!==h?h:"en",notifications:{email:null===(p=null===F||void 0===F||null===(t=F.preferences)||void 0===t||null===(n=t.notifications)||void 0===n?void 0:n.email)||void 0===p||p,push:null!==(f=null===F||void 0===F||null===(o=F.preferences)||void 0===o||null===(l=o.notifications)||void 0===l?void 0:l.push)&&void 0!==f&&f,projectUpdates:e.target.checked,careerMilestones:null===(g=null===F||void 0===F||null===(r=F.preferences)||void 0===r||null===(s=r.notifications)||void 0===s?void 0:s.careerMilestones)||void 0===g||g,familyAnnouncements:null===(x=null===F||void 0===F||null===(c=F.preferences)||void 0===c||null===(d=c.notifications)||void 0===d?void 0:d.familyAnnouncements)||void 0===x||x},dashboardLayout:null!==(y=null===F||void 0===F||null===(u=F.preferences)||void 0===u?void 0:u.dashboardLayout)&&void 0!==y?y:[],gamificationEnabled:null===(b=null===F||void 0===F||null===(v=F.preferences)||void 0===v?void 0:v.gamificationEnabled)||void 0===b||b}})}catch(j){}}}),(0,n.jsx)(U.dN,{label:"Family announcements",hint:"Important family news and updates",checked:null===(se=null===F||void 0===F||null===(u=F.preferences)||void 0===u||null===(c=u.notifications)||void 0===c?void 0:c.familyAnnouncements)||void 0===se||se,onChange:async e=>{try{var i,a,n,t,l,o,s,r,d,c,u,v,m,h,p,f,g,x,y,b;await L({preferences:{theme:null!==(m=null===F||void 0===F||null===(i=F.preferences)||void 0===i?void 0:i.theme)&&void 0!==m?m:"light",language:null!==(h=null===F||void 0===F||null===(a=F.preferences)||void 0===a?void 0:a.language)&&void 0!==h?h:"en",notifications:{email:null===(p=null===F||void 0===F||null===(t=F.preferences)||void 0===t||null===(n=t.notifications)||void 0===n?void 0:n.email)||void 0===p||p,push:null!==(f=null===F||void 0===F||null===(o=F.preferences)||void 0===o||null===(l=o.notifications)||void 0===l?void 0:l.push)&&void 0!==f&&f,projectUpdates:null===(g=null===F||void 0===F||null===(r=F.preferences)||void 0===r||null===(s=r.notifications)||void 0===s?void 0:s.projectUpdates)||void 0===g||g,careerMilestones:null===(x=null===F||void 0===F||null===(c=F.preferences)||void 0===c||null===(d=c.notifications)||void 0===d?void 0:d.careerMilestones)||void 0===x||x,familyAnnouncements:e.target.checked},dashboardLayout:null!==(y=null===F||void 0===F||null===(u=F.preferences)||void 0===u?void 0:u.dashboardLayout)&&void 0!==y?y:[],gamificationEnabled:null===(b=null===F||void 0===F||null===(v=F.preferences)||void 0===v?void 0:v.gamificationEnabled)||void 0===b||b}})}catch(j){}}}),(0,n.jsx)(U.dN,{label:"Achievement alerts",hint:"When you earn new badges or level up",checked:null===(re=null===F||void 0===F||null===(m=F.preferences)||void 0===m||null===(v=m.notifications)||void 0===v?void 0:v.careerMilestones)||void 0===re||re,onChange:async e=>{try{var i,a,n,t,l,o,s,r,d,c,u,v,m,h,p,f,g,x,y,b;await L({preferences:{theme:null!==(m=null===F||void 0===F||null===(i=F.preferences)||void 0===i?void 0:i.theme)&&void 0!==m?m:"light",language:null!==(h=null===F||void 0===F||null===(a=F.preferences)||void 0===a?void 0:a.language)&&void 0!==h?h:"en",notifications:{email:null===(p=null===F||void 0===F||null===(t=F.preferences)||void 0===t||null===(n=t.notifications)||void 0===n?void 0:n.email)||void 0===p||p,push:null!==(f=null===F||void 0===F||null===(o=F.preferences)||void 0===o||null===(l=o.notifications)||void 0===l?void 0:l.push)&&void 0!==f&&f,projectUpdates:null===(g=null===F||void 0===F||null===(r=F.preferences)||void 0===r||null===(s=r.notifications)||void 0===s?void 0:s.projectUpdates)||void 0===g||g,careerMilestones:e.target.checked,familyAnnouncements:null===(x=null===F||void 0===F||null===(c=F.preferences)||void 0===c||null===(d=c.notifications)||void 0===d?void 0:d.familyAnnouncements)||void 0===x||x},dashboardLayout:null!==(y=null===F||void 0===F||null===(u=F.preferences)||void 0===u?void 0:u.dashboardLayout)&&void 0!==y?y:[],gamificationEnabled:null===(b=null===F||void 0===F||null===(v=F.preferences)||void 0===v?void 0:v.gamificationEnabled)||void 0===b||b}})}catch(j){}}})]})]}),"language"===G&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Language & Region"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Customize your language preferences and regional settings."})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(U.SB,{label:"Preferred Language",options:[{value:"en",label:"English"},{value:"af",label:"Afrikaans"},{value:"zu",label:"isiZulu"},{value:"xh",label:"isiXhosa"},{value:"st",label:"Sesotho"},{value:"tn",label:"Setswana"},{value:"nso",label:"Sepedi"},{value:"ts",label:"Xitsonga"},{value:"ss",label:"siSwati"},{value:"ve",label:"Tshivenda"},{value:"nr",label:"isiNdebele"},{value:"fr",label:"Fran\xe7ais (French)"},{value:"pt",label:"Portugu\xeas (Portuguese)"},{value:"sn",label:"Shona"},{value:"sw",label:"Kiswahili (Swahili)"}]}),(0,n.jsx)(U.SB,{label:"Time Zone",options:[{value:"Africa/Johannesburg",label:"South Africa Standard Time (SAST)"},{value:"Africa/Nairobi",label:"East Africa Time (EAT)"},{value:"Africa/Lagos",label:"West Africa Time (WAT)"}]}),(0,n.jsx)(U.SB,{label:"Date Format",options:[{value:"dd/mm/yyyy",label:"DD/MM/YYYY"},{value:"mm/dd/yyyy",label:"MM/DD/YYYY"},{value:"yyyy-mm-dd",label:"YYYY-MM-DD"}]})]})]}),"gamification"===G&&(0,n.jsxs)("div",{className:"space-y-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Gamification Settings"}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Manage how you experience achievements, levels, and family competitions."})]}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)(U.dN,{label:"Enable gamification",hint:"Show XP, levels, and achievements",defaultChecked:!0}),(0,n.jsx)(U.dN,{label:"Show on leaderboard",hint:"Display your rank to family members",defaultChecked:!0}),(0,n.jsx)(U.dN,{label:"Streak reminders",hint:"Get reminded to maintain your streaks",defaultChecked:!0})]}),(0,n.jsxs)("div",{className:"mt-6 p-4 bg-primary-50 rounded-lg border border-primary-200",children:[(0,n.jsx)("h3",{className:"font-semibold text-primary-900 mb-3",children:"Your Current Stats"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-primary-700",children:(null===F||void 0===F||null===(h=F.gamification)||void 0===h?void 0:h.level)||1}),(0,n.jsx)("div",{className:"text-sm text-primary-600",children:"Current Level"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-primary-700",children:(null===F||void 0===F||null===(f=F.gamification)||void 0===f?void 0:f.experiencePoints)||0}),(0,n.jsx)("div",{className:"text-sm text-primary-600",children:"Total XP"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-primary-700",children:(null===F||void 0===F||null===(E=F.gamification)||void 0===E||null===(T=E.badges)||void 0===T?void 0:T.length)||0}),(0,n.jsx)("div",{className:"text-sm text-primary-600",children:"Badges Earned"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-primary-700",children:(null===F||void 0===F||null===(M=F.gamification)||void 0===M||null===(A=M.streaks)||void 0===A?void 0:A.length)||0}),(0,n.jsx)("div",{className:"text-sm text-primary-600",children:"Active Streaks"})]})]})]})]})]})})]})]})})}},89616:function(e,i,a){"use strict";a.r(i),a.d(i,{notificationService:function(){return s}});var n=a(97042),t=a(22806),l=a(99724),o=a(34155);const s=new class{async requestPermission(){if(!("Notification"in window))throw new Error("This browser does not support notifications");return await Notification.requestPermission()}async getFCMToken(){try{if(!n.Fw)return null;if("granted"!==await this.requestPermission())return null;return await(0,t.LP)(n.Fw,{vapidKey:this.vapidKey})}catch(e){return null}}async saveTokenToUser(e,i){try{const a=(0,l.JU)(n.db,"users",e);await(0,l.r7)(a,{fcmToken:i,notificationsEnabled:!0,lastTokenUpdate:new Date})}catch(a){throw a}}async removeTokenFromUser(e){try{const i=(0,l.JU)(n.db,"users",e);await(0,l.r7)(i,{fcmToken:null,notificationsEnabled:!1,lastTokenUpdate:new Date})}catch(i){throw i}}initializeForegroundMessages(){n.Fw&&(0,t.ps)(n.Fw,(e=>{const i=e.notification;i&&this.showNotification({title:i.title||"Salatiso Notification",body:i.body||"",icon:i.icon,data:e.data})}))}showNotification(e){if("granted"!==Notification.permission)return;const i={body:e.body,icon:e.icon||"/favicon.ico",badge:e.badge,tag:e.tag,requireInteraction:e.requireInteraction,data:e.data};e.actions&&e.actions.length>0&&(i.actions=e.actions);const a=new Notification(e.title,i);e.requireInteraction||setTimeout((()=>{a.close()}),5e3),a.onclick=()=>{var i;window.focus(),a.close(),(null===(i=e.data)||void 0===i?void 0:i.action)&&this.handleNotificationAction(e.data.action,e.data)},e.actions&&(a.onshow=()=>{})}handleNotificationAction(e,i){switch(e){case"view_family_update":window.location.href="/intranet/family?update=".concat(i.updateId);break;case"view_project":window.location.href="/intranet/projects?id=".concat(i.projectId);break;case"view_achievement":window.location.href="/intranet/profile?tab=achievements";break;case"view_announcement":window.location.href="/intranet/announcements?id=".concat(i.announcementId)}}async sendTestNotification(e){try{const i=(0,l.JU)(n.db,"users",e),a=await(0,l.QT)(i);if(!a.exists())throw new Error("User not found");if(!a.data().fcmToken)throw new Error("User has no FCM token");this.showNotification({title:"Test Notification",body:"This is a test push notification from Salatiso!",tag:"test-notification"})}catch(i){throw i}}isSupported(){return"Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window}getPermissionStatus(){return"Notification"in window?Notification.permission:"denied"}constructor(){this.vapidKey=o.env.NEXT_PUBLIC_FIREBASE_VAPID_KEY}};i.default=s}},function(e){e.O(0,[4179,2806,3664,5047,2888,9774,179],(function(){return i=76567,e(e.s=i);var i}));var i=e.O();_N_E=i}]);