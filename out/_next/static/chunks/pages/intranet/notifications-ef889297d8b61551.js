(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1642],{44839:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/intranet/notifications",function(){return a(34324)}])},52217:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},77918:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]])},50039:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},43832:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},15928:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},15452:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},70088:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]])},37864:function(e,t,a){"use strict";a.d(t,{Z:function(){return s}});const s=(0,a(63759).Z)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},34324:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j},metadata:function(){return v}});var s,n=a(85893),r=a(67294),i=a(60837),c=a(99724),o=a(97042);!function(e){e.LOW="low",e.MEDIUM="medium",e.HIGH="high",e.CRITICAL="critical"}(s||(s={}));const l=new class{async createNotification(e,t){try{const a=c.EK.now(),s={userId:e,type:t.type,priority:t.priority||"medium",title:t.title,message:t.message,actionUrl:t.actionUrl||null,actionLabel:t.actionLabel||null,data:t.data||{},read:!1,createdAt:a,expiresAt:t.expiresIn?c.EK.fromDate(new Date(a.toDate().getTime()+36e5*t.expiresIn)):null,relatedEventId:t.relatedEventId||null,relatedUserId:t.relatedUserId||null,archived:!1};return{success:!0,data:{id:(await(0,c.ET)((0,c.hJ)(o.db,this.collectionName),s)).id,...s},timestamp:new Date}}catch(a){return{success:!1,error:"Failed to create notification: ".concat(a.message),timestamp:new Date}}}async getNotification(e,t){try{const a=(0,c.JU)(o.db,this.collectionName,t),s=await(0,c.QT)(a);if(!s.exists())return{success:!1,error:"Notification not found",timestamp:new Date};const n={id:s.id,...s.data()};return n.userId!==e?{success:!1,error:"Access denied",timestamp:new Date}:{success:!0,data:n,timestamp:new Date}}catch(a){return{success:!1,error:"Failed to get notification: ".concat(a.message),timestamp:new Date}}}async updateNotification(e,t,a){try{const s=await this.getNotification(e,t);if(!s.success)return s;const n=(0,c.JU)(o.db,this.collectionName,t),r={...a};!0===a.read&&(r.readAt=c.EK.now()),await(0,c.r7)(n,r);return await this.getNotification(e,t)}catch(s){return{success:!1,error:"Failed to update notification: ".concat(s.message),timestamp:new Date}}}async deleteNotification(e,t){try{return(await this.getNotification(e,t)).success?(await(0,c.oe)((0,c.JU)(o.db,this.collectionName,t)),{success:!0,data:null,timestamp:new Date}):{success:!1,error:"Notification not found",timestamp:new Date}}catch(a){return{success:!1,error:"Failed to delete notification: ".concat(a.message),timestamp:new Date}}}async markAsRead(e,t){try{const e=(0,c.JU)(o.db,this.collectionName,t);return await(0,c.r7)(e,{read:!0,readAt:c.EK.now()}),{success:!0,data:null,timestamp:new Date}}catch(a){return{success:!1,error:"Failed to mark as read: ".concat(a.message),timestamp:new Date}}}async markAsUnread(e,t){try{const e=(0,c.JU)(o.db,this.collectionName,t);return await(0,c.r7)(e,{read:!1,readAt:null}),{success:!0,data:null,timestamp:new Date}}catch(a){return{success:!1,error:"Failed to mark as unread: ".concat(a.message),timestamp:new Date}}}async markAllAsRead(e){try{const t=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("userId","==",e),(0,c.ar)("read","==",!1)),a=await(0,c.PL)(t),s=(0,c.qs)(o.db);return a.docs.forEach((e=>{s.update(e.ref,{read:!0,readAt:c.EK.now()})})),await s.commit(),{success:!0,data:null,timestamp:new Date}}catch(t){return{success:!1,error:"Failed to mark all as read: ".concat(t.message),timestamp:new Date}}}async getNotifications(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};try{const s=a.pageSize||10,n=a.pageNumber||1,r=(n-1)*s,i=[(0,c.ar)("userId","==",e)];t.type&&i.push((0,c.ar)("type","==",t.type)),t.priority&&i.push((0,c.ar)("priority","==",t.priority)),void 0!==t.read&&i.push((0,c.ar)("read","==",t.read)),void 0!==t.archived&&i.push((0,c.ar)("archived","==",t.archived));const l=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),...i,(0,c.Xo)("createdAt","desc"),(0,c.b9)(5*s)),d=(await(0,c.PL)(l)).docs.map((e=>({id:e.id,...e.data()}))),u=d.length,m=d.slice(r,r+s);return{success:!0,data:{items:m,total:u,page:n,pageSize:s,totalPages:Math.ceil(u/s)},timestamp:new Date}}catch(s){return{success:!1,error:"Failed to get notifications: ".concat(s.message),timestamp:new Date}}}async getUnreadCount(e){try{const t=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("userId","==",e),(0,c.ar)("read","==",!1));return{success:!0,data:(await(0,c.PL)(t)).size,timestamp:new Date}}catch(t){return{success:!1,error:"Failed to get unread count: ".concat(t.message),timestamp:new Date}}}async getNotificationsByType(e,t){try{const a=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("userId","==",e),(0,c.ar)("type","==",t),(0,c.Xo)("createdAt","desc"),(0,c.b9)(50)),s=await(0,c.PL)(a);return{success:!0,data:s.docs.map((e=>({id:e.id,...e.data()}))),timestamp:new Date}}catch(a){return{success:!1,error:"Failed to get notifications by type: ".concat(a.message),timestamp:new Date}}}subscribeToNotifications(e,t,a){const s=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("userId","==",e),(0,c.Xo)("createdAt","desc"),(0,c.b9)(50));return(0,c.cf)(s,(e=>{const a=e.docs.map((e=>({id:e.id,...e.data()})));t(a)}),(e=>{a&&a(e)}))}subscribeToUnreadCount(e,t,a){const s=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("userId","==",e),(0,c.ar)("read","==",!1));return(0,c.cf)(s,(e=>{t(e.size)}),(e=>{a&&a(e)}))}async deleteOlderThan(e,t){try{const a=c.EK.fromDate(new Date(Date.now()-24*t*60*60*1e3)),s=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("userId","==",e),(0,c.ar)("createdAt","<",a)),n=await(0,c.PL)(s),r=(0,c.qs)(o.db);return n.docs.forEach((e=>{r.delete(e.ref)})),await r.commit(),{success:!0,data:null,timestamp:new Date}}catch(a){return{success:!1,error:"Failed to delete old notifications: ".concat(a.message),timestamp:new Date}}}async archiveNotifications(e,t){try{const e=(0,c.qs)(o.db);for(const a of t){const t=(0,c.JU)(o.db,this.collectionName,a);e.update(t,{archived:!0})}return await e.commit(),{success:!0,data:null,timestamp:new Date}}catch(a){return{success:!1,error:"Failed to archive notifications: ".concat(a.message),timestamp:new Date}}}async getNotificationsForEvent(e){try{const t=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("relatedEventId","==",e),(0,c.Xo)("createdAt","desc")),a=await(0,c.PL)(t);return{success:!0,data:a.docs.map((e=>({id:e.id,...e.data()}))),timestamp:new Date}}catch(t){return{success:!1,error:"Failed to get event notifications: ".concat(t.message),timestamp:new Date}}}async deleteNotificationsForEvent(e){try{const t=(0,c.IO)((0,c.hJ)(o.db,this.collectionName),(0,c.ar)("relatedEventId","==",e)),a=await(0,c.PL)(t),s=(0,c.qs)(o.db);return a.docs.forEach((e=>{s.delete(e.ref)})),await s.commit(),{success:!0,data:null,timestamp:new Date}}catch(t){return{success:!1,error:"Failed to delete event notifications: ".concat(t.message),timestamp:new Date}}}constructor(){this.collectionName="notifications"}};var d=a(51526),u=a(12023),m=a(43765),h=a(50039),f=a(15452),p=a(52217),x=a(70088),y=a(77918),g=a(43832),w=a(15928),b=a(37864);const N=e=>{let{userId:t,onNotificationClick:a,maxItems:s=10}=e;const{user:c}=(0,i.a)(),o=t||(null===c||void 0===c?void 0:c.id),[N,v]=(0,r.useState)([]),[j,k]=(0,r.useState)(0),[E,D]=(0,r.useState)(!0),[I,A]=(0,r.useState)(null);(0,r.useEffect)((()=>{if(!o)return;return l.subscribeToNotifications(o,(e=>{v(e),D(!1)}))}),[o]),(0,r.useEffect)((()=>{if(!o)return;return l.subscribeToUnreadCount(o,k)}),[o]);const C=e=>({critical:(0,n.jsx)(m.Z,{className:"w-5 h-5 text-red-600"}),reminder:(0,n.jsx)(h.Z,{className:"w-5 h-5 text-blue-600"}),mention:(0,n.jsx)(f.Z,{className:"w-5 h-5 text-purple-600"}),activity:(0,n.jsx)(p.Z,{className:"w-5 h-5 text-green-600"})}[e]||(0,n.jsx)(x.Z,{className:"w-5 h-5 text-gray-600"})),M=e=>{var t;const a=(null===(t=e.toDate)||void 0===t?void 0:t.call(e))||new Date(e),s=(new Date).getTime()-a.getTime(),n=Math.floor(s/6e4);return n<1?"Just now":n<60?"".concat(n,"m ago"):n<1440?"".concat(Math.floor(n/60),"h ago"):"".concat(Math.floor(n/1440),"d ago")};if(E)return(0,n.jsx)("div",{className:"flex justify-center p-8",children:(0,n.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});const Z=N.slice(0,s);return(0,n.jsxs)("div",{className:"w-full max-w-4xl mx-auto",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(y.Z,{className:"w-6 h-6 text-blue-600"}),(0,n.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Notifications"}),j>0&&(0,n.jsx)("span",{className:"inline-flex items-center justify-center w-6 h-6 text-xs font-bold text-white bg-red-600 rounded-full",children:j})]}),(0,n.jsx)("button",{onClick:async()=>{o&&await l.markAllAsRead(o)},className:"px-3 py-1 text-sm text-white bg-blue-600 rounded hover:bg-blue-700",children:"Mark All Read"})]}),(0,n.jsx)("div",{className:"space-y-3",children:(0,n.jsx)(d.M,{children:0===Z.length?(0,n.jsxs)(u.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"p-8 text-center bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:[(0,n.jsx)(y.Z,{className:"w-12 h-12 text-gray-400 mx-auto mb-3"}),(0,n.jsx)("p",{className:"text-gray-500",children:"No notifications"})]}):Z.map((e=>(0,n.jsx)(u.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},className:"p-4 border-l-4 border-blue-500 bg-blue-50 rounded-lg cursor-pointer transition-all",onClick:()=>{A(e),!e.read&&o&&l.markAsRead(o,e.id),a&&a(e)},children:(0,n.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,n.jsxs)("div",{className:"flex items-start gap-3 flex-1",children:[(0,n.jsx)("div",{className:"mt-1",children:C(e.type)}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("h3",{className:"font-semibold text-gray-800",children:[e.title,!e.read&&(0,n.jsx)("span",{className:"inline-block w-2 h-2 bg-blue-600 rounded-full ml-2"})]}),(0,n.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.message}),(0,n.jsxs)("div",{className:"flex items-center gap-4 mt-2",children:[(0,n.jsx)("span",{className:"text-xs text-gray-500",children:M(e.createdAt)}),e.actionLabel&&e.actionUrl&&(0,n.jsxs)("a",{href:e.actionUrl,className:"text-xs font-semibold text-blue-600 hover:underline",onClick:e=>e.stopPropagation(),children:[e.actionLabel," \u2192"]})]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:t=>(async(e,t)=>{e.stopPropagation(),o&&await l.markAsRead(o,t)})(t,e.id),className:"p-2 text-gray-600 hover:text-blue-600 transition-colors",title:"Mark as read",children:e.read?(0,n.jsx)(g.Z,{className:"w-4 h-4"}):(0,n.jsx)(w.Z,{className:"w-4 h-4"})}),(0,n.jsx)("button",{onClick:t=>(async(e,t)=>{e.stopPropagation(),o&&await l.deleteNotification(o,t)})(t,e.id),className:"p-2 text-gray-600 hover:text-red-600 transition-colors",title:"Delete",children:(0,n.jsx)(b.Z,{className:"w-4 h-4"})})]})]})},e.id)))})}),(0,n.jsx)(d.M,{children:I&&(0,n.jsx)(u.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>A(null),className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,n.jsxs)(u.E.div,{initial:{scale:.95},animate:{scale:1},exit:{scale:.95},onClick:e=>e.stopPropagation(),className:"bg-white rounded-lg p-6 max-w-md w-full shadow-lg",children:[(0,n.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[C(I.type),(0,n.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:I.title})]}),(0,n.jsx)("p",{className:"text-gray-600 mb-4",children:I.message}),I.data&&(0,n.jsx)("div",{className:"bg-gray-50 p-3 rounded text-sm mb-4",children:(0,n.jsx)("pre",{className:"overflow-auto max-h-40",children:JSON.stringify(I.data,null,2)})}),(0,n.jsxs)("div",{className:"flex gap-2",children:[I.actionUrl&&(0,n.jsx)("a",{href:I.actionUrl,className:"flex-1 px-3 py-2 bg-blue-600 text-white rounded text-center hover:bg-blue-700 transition-colors",children:I.actionLabel||"Go to"}),(0,n.jsx)("button",{onClick:()=>A(null),className:"px-3 py-2 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 transition-colors",children:"Close"})]})]})})})]})};const v={title:"Notifications | Salatiso",description:"View and manage your notifications"};function j(){return(0,n.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,n.jsx)(N,{})})}},51526:function(e,t,a){"use strict";a.d(t,{M:function(){return x}});var s=a(67294),n=a(58868);function r(){const e=(0,s.useRef)(!1);return(0,n.L)((()=>(e.current=!0,()=>{e.current=!1})),[]),e}var i=a(2074);var c=a(240),o=a(96681);class l extends s.Component{getSnapshotBeforeUpdate(e){const t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){const e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d({children:e,isPresent:t}){const a=(0,s.useId)(),n=(0,s.useRef)(null),r=(0,s.useRef)({width:0,height:0,top:0,left:0});return(0,s.useInsertionEffect)((()=>{const{width:e,height:s,top:i,left:c}=r.current;if(t||!n.current||!e||!s)return;n.current.dataset.motionPopId=a;const o=document.createElement("style");return document.head.appendChild(o),o.sheet&&o.sheet.insertRule(`\n          [data-motion-pop-id="${a}"] {\n            position: absolute !important;\n            width: ${e}px !important;\n            height: ${s}px !important;\n            top: ${i}px !important;\n            left: ${c}px !important;\n          }\n        `),()=>{document.head.removeChild(o)}}),[t]),s.createElement(l,{isPresent:t,childRef:n,sizeRef:r},s.cloneElement(e,{ref:n}))}const u=({children:e,initial:t,isPresent:a,onExitComplete:n,custom:r,presenceAffectsLayout:i,mode:l})=>{const u=(0,o.h)(m),h=(0,s.useId)(),f=(0,s.useMemo)((()=>({id:h,initial:t,isPresent:a,custom:r,onExitComplete:e=>{u.set(e,!0);for(const t of u.values())if(!t)return;n&&n()},register:e=>(u.set(e,!1),()=>u.delete(e))})),i?void 0:[a]);return(0,s.useMemo)((()=>{u.forEach(((e,t)=>u.set(t,!1)))}),[a]),s.useEffect((()=>{!a&&!u.size&&n&&n()}),[a]),"popLayout"===l&&(e=s.createElement(d,{isPresent:a},e)),s.createElement(c.O.Provider,{value:f},e)};function m(){return new Map}var h=a(25364);var f=a(45487);const p=e=>e.key||"";const x=({children:e,custom:t,initial:a=!0,onExitComplete:c,exitBeforeEnter:o,presenceAffectsLayout:l=!0,mode:d="sync"})=>{(0,f.k)(!o,"Replace exitBeforeEnter with mode='wait'");const m=(0,s.useContext)(h.p).forceRender||function(){const e=r(),[t,a]=(0,s.useState)(0),n=(0,s.useCallback)((()=>{e.current&&a(t+1)}),[t]);return[(0,s.useCallback)((()=>i.Wi.postRender(n)),[n]),t]}()[0],x=r(),y=function(e){const t=[];return s.Children.forEach(e,(e=>{(0,s.isValidElement)(e)&&t.push(e)})),t}(e);let g=y;const w=(0,s.useRef)(new Map).current,b=(0,s.useRef)(g),N=(0,s.useRef)(new Map).current,v=(0,s.useRef)(!0);var j;if((0,n.L)((()=>{v.current=!1,function(e,t){e.forEach((e=>{const a=p(e);t.set(a,e)}))}(y,N),b.current=g})),j=()=>{v.current=!0,N.clear(),w.clear()},(0,s.useEffect)((()=>()=>j()),[]),v.current)return s.createElement(s.Fragment,null,g.map((e=>s.createElement(u,{key:p(e),isPresent:!0,initial:!!a&&void 0,presenceAffectsLayout:l,mode:d},e))));g=[...g];const k=b.current.map(p),E=y.map(p),D=k.length;for(let s=0;s<D;s++){const e=k[s];-1!==E.indexOf(e)||w.has(e)||w.set(e,void 0)}return"wait"===d&&w.size&&(g=[]),w.forEach(((e,a)=>{if(-1!==E.indexOf(a))return;const n=N.get(a);if(!n)return;const r=k.indexOf(a);let i=e;if(!i){const e=()=>{N.delete(a),w.delete(a);const e=b.current.findIndex((e=>e.key===a));if(b.current.splice(e,1),!w.size){if(b.current=y,!1===x.current)return;m(),c&&c()}};i=s.createElement(u,{key:p(n),isPresent:!1,onExitComplete:e,custom:t,presenceAffectsLayout:l,mode:d},n),w.set(a,i)}g.splice(r,0,i)})),g=g.map((e=>{const t=e.key;return w.has(t)?e:s.createElement(u,{key:p(e),isPresent:!0,presenceAffectsLayout:l,mode:d},e)})),s.createElement(s.Fragment,null,w.size?g:g.map((e=>(0,s.cloneElement)(e))))}}},function(e){e.O(0,[2023,2888,9774,179],(function(){return t=44839,e(e.s=t);var t}));var t=e.O();_N_E=t}]);