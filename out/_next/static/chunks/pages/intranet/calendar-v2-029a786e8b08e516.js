(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3044],{53205:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/intranet/calendar-v2",function(){return s(67541)}])},21427:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});const a=(0,s(1).Z)("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]])},47782:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});const a=(0,s(1).Z)("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]])},31928:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});const a=(0,s(1).Z)("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]])},36460:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});const a=(0,s(1).Z)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},67541:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return K}});var a,n,r,i,l,o,c,d,u,m,x,h,g,p,v,y=s(85893),b=s(67294),f=s(12023),j=s(31928),N=s(42392),E=s(72003),w=s(36460),D=s(37568),C=s(46194),T=s(17911),I=s(56286),A=s(35131),S=s(78992),R=s(89934);!function(e){e.INDIVIDUAL="individual",e.FAMILY="family",e.COMMUNITY="community",e.PROFESSIONAL="professional"}(a||(a={})),function(e){e.ACTIVITY="activity",e.INCIDENT="incident"}(n||(n={})),function(e){e.MEETING="meeting",e.CELEBRATION="celebration",e.PROJECT="project",e.WELLNESS="wellness",e.FAMILY_TIME="family_time",e.COMMUNITY_EVENT="community_event",e.OTHER="other"}(r||(r={})),function(e){e.HEALTH="health",e.SAFETY="safety",e.PROPERTY="property",e.EMOTIONAL_SUPPORT="emotional_support",e.OTHER="other"}(i||(i={})),function(e){e.CRITICAL="critical",e.HIGH="high",e.MEDIUM="medium",e.LOW="low"}(l||(l={})),function(e){e.PLANNED="planned",e.OPEN="open",e.IN_PROGRESS="in_progress",e.RESOLVED="resolved",e.ARCHIVED="archived"}(o||(o={})),function(e){e.ORGANIZER="organizer",e.PARTICIPANT="participant",e.SUPPORTER="supporter",e.STEWARD="steward"}(c||(c={})),function(e){e.ASSIGNED="assigned",e.ACCEPTED="accepted",e.DECLINED="declined",e.COMPLETED="completed"}(d||(d={})),function(e){e.VIEW="view",e.EDIT="edit",e.RESPOND="respond",e.ESCALATE="escalate",e.ASSIGN_ROLES="assign_roles",e.APPROVE="approve",e.RESOLVE="resolve",e.REPORT="report",e.ARCHIVE="archive"}(u||(u={})),function(e){e.LOGISTICS="logistics",e.SETUP="setup",e.SUPPORT="support",e.SKILLS="skills",e.RESOURCES="resources",e.OTHER="other"}(m||(m={})),function(e){e.REQUESTED="requested",e.OFFERED="offered",e.ACCEPTED="accepted",e.IN_PROGRESS="in_progress",e.COMPLETED="completed",e.DECLINED="declined"}(x||(x={})),function(e){e.SINGLE_CHOICE="single_choice",e.MULTIPLE_CHOICE="multiple_choice",e.RANKING="ranking"}(h||(h={})),function(e){e.OPEN="open",e.CLOSED="closed",e.ARCHIVED="archived"}(g||(g={})),function(e){e.LOG="log",e.NOTIFY_FAMILY="notify_family",e.NOTIFY_COMMUNITY="notify_community",e.NOTIFY_PROFESSIONAL="notify_professional",e.AUTO_ESCALATE="auto_escalate",e.MANUAL_ESCALATE="manual_escalate"}(p||(p={})),function(e){e.CREATED="created",e.UPDATED="updated",e.ASSIGNED_ROLE="assigned_role",e.RESPONDED_ROLE="responded_role",e.REQUESTED_ASSISTANCE="requested_assistance",e.OFFERED_ASSISTANCE="offered_assistance",e.CREATED_POLL="created_poll",e.VOTED="voted",e.LOGGED_INCIDENT="logged_incident",e.ESCALATED="escalated",e.RESOLVED="resolved",e.ARCHIVED="archived",e.COMMENTED="commented"}(v||(v={}));const O={organizer:["view","edit","respond","escalate","assign_roles","approve","resolve","report","archive"],participant:["view","respond"],supporter:["view","respond"],steward:["view","edit","respond","escalate","assign_roles","approve","resolve","report","archive"]},k={critical:{escalateTo:"professional",notifyDelay:0},high:{escalateTo:"community",notifyDelay:5},medium:{escalateTo:"family",notifyDelay:15},low:{escalateTo:"individual",notifyDelay:60}};function P(e){return"incident"===e.type}const L={[a.INDIVIDUAL]:{label:"Personal",description:"My personal events and activities",icon:(0,y.jsx)(T.Z,{className:"w-5 h-5"}),color:"text-blue-600",bgColor:"bg-blue-50 border-blue-200"},[a.FAMILY]:{label:"Family",description:"Family events and gatherings",icon:(0,y.jsx)(I.Z,{className:"w-5 h-5"}),color:"text-red-600",bgColor:"bg-red-50 border-red-200"},[a.COMMUNITY]:{label:"Community",description:"Community and group events",icon:(0,y.jsx)(A.Z,{className:"w-5 h-5"}),color:"text-green-600",bgColor:"bg-green-50 border-green-200"},[a.PROFESSIONAL]:{label:"Professional",description:"Work and professional events",icon:(0,y.jsx)(S.Z,{className:"w-5 h-5"}),color:"text-indigo-600",bgColor:"bg-indigo-50 border-indigo-200"}};var _=e=>{let{current:t,onChange:s}=e;const[n,r]=(0,b.useState)(!1),[i,l]=(0,b.useState)(!1);(0,b.useEffect)((()=>{l(!0)}),[]);const o=e=>{s(e),r(!1),localStorage.setItem("calendar-context",e)};if(!i)return null;const c=L[t];return(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("div",{className:"hidden sm:flex gap-2 flex-wrap",children:Object.values(a).map((e=>{const s=L[e],a=t===e;return(0,y.jsxs)(f.E.button,{onClick:()=>o(e),whileHover:{scale:1.05},whileTap:{scale:.95},className:"\n                px-4 py-2 rounded-lg font-medium transition-all flex items-center gap-2\n                ".concat(a?"".concat(s.bgColor," border-2 ").concat(s.color," shadow-md"):"bg-white border border-gray-200 text-gray-700 hover:border-gray-300","\n              "),title:s.description,children:[s.icon,(0,y.jsx)("span",{className:"hidden md:inline",children:s.label})]},e)}))}),(0,y.jsxs)("div",{className:"sm:hidden",children:[(0,y.jsxs)(f.E.button,{onClick:()=>r(!n),whileHover:{scale:1.02},whileTap:{scale:.98},className:"\n            w-full px-4 py-3 rounded-lg font-medium transition-all flex items-center justify-between\n            ".concat(c.bgColor," border-2 ").concat(c.color," shadow-md\n          "),children:[(0,y.jsxs)("div",{className:"flex items-center gap-2",children:[c.icon,(0,y.jsx)("span",{children:c.label})]}),(0,y.jsx)(f.E.div,{animate:{rotate:n?180:0},transition:{duration:.2},children:(0,y.jsx)(R.Z,{className:"w-5 h-5"})})]}),n&&(0,y.jsx)(f.E.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"absolute top-full left-0 right-0 mt-2 bg-white rounded-lg shadow-lg border border-gray-200 z-50 overflow-hidden",children:Object.values(a).map((e=>{const s=L[e],a=t===e;return(0,y.jsxs)(f.E.button,{onClick:()=>o(e),whileHover:{backgroundColor:"rgba(0,0,0,0.02)"},className:"\n                    w-full px-4 py-3 text-left transition-colors flex items-center gap-3\n                    border-b border-gray-100 last:border-b-0\n                    ".concat(a?"".concat(s.bgColor," font-semibold"):"hover:bg-gray-50","\n                  "),children:[(0,y.jsx)("span",{className:s.color,children:s.icon}),(0,y.jsxs)("div",{children:[(0,y.jsx)("div",{className:"font-medium text-gray-900",children:s.label}),(0,y.jsx)("div",{className:"text-xs text-gray-600",children:s.description})]})]},e)}))})]}),(0,y.jsx)(f.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"mt-2 hidden md:block px-4 py-2 rounded-lg text-sm ".concat(c.bgColor," border"),children:(0,y.jsx)("p",{className:"font-medium ".concat(c.color),children:c.description})})]})},M=s(21427),U=s(47782);var H=e=>{let{events:t,currentMonth:s,selectedDate:a,onMonthChange:r,onDateSelect:i,onEventSelect:c,viewMode:d="month"}=e;const[u,m]=(0,b.useState)(null),x=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],h=e=>t.filter((t=>new Date(t.dateTime).toDateString()===e.toDateString())),g=new Date,p=e=>{if(e.type===n.INCIDENT&&e.incidentData){const t=e.incidentData.severity||l.MEDIUM;return{[l.CRITICAL]:"bg-red-500",[l.HIGH]:"bg-orange-500",[l.MEDIUM]:"bg-yellow-500",[l.LOW]:"bg-yellow-400"}[t]}return"bg-blue-500"},v=e=>({[o.PLANNED]:"bg-gray-100 text-gray-800",[o.OPEN]:"bg-blue-100 text-blue-800",[o.IN_PROGRESS]:"bg-yellow-100 text-yellow-800",[o.RESOLVED]:"bg-green-100 text-green-800",[o.ARCHIVED]:"bg-gray-100 text-gray-800"}[e]);return(0,y.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,y.jsx)(f.E.button,{onClick:()=>{r(new Date(s.getFullYear(),s.getMonth()-1))},whileHover:{scale:1.1},whileTap:{scale:.95},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,y.jsx)(M.Z,{className:"w-6 h-6 text-gray-600"})}),(0,y.jsxs)("h2",{className:"text-xl font-bold text-gray-900 min-w-48 text-center",children:[["January","February","March","April","May","June","July","August","September","October","November","December"][s.getMonth()]," ",s.getFullYear()]}),(0,y.jsx)(f.E.button,{onClick:()=>{r(new Date(s.getFullYear(),s.getMonth()+1))},whileHover:{scale:1.1},whileTap:{scale:.95},className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:(0,y.jsx)(U.Z,{className:"w-6 h-6 text-gray-600"})})]}),"month"===d&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("div",{className:"grid grid-cols-7 gap-0 mb-2",children:x.map((e=>(0,y.jsx)("div",{className:"text-center py-2 text-sm font-semibold text-gray-600",children:e},e)))}),(0,y.jsx)("div",{className:"grid grid-cols-7 gap-0 border border-gray-200 bg-gray-50 rounded-lg overflow-hidden",children:(()=>{const e=(t=s,new Date(t.getFullYear(),t.getMonth()+1,0).getDate());var t;const r=(e=>new Date(e.getFullYear(),e.getMonth(),1).getDay())(s),l=[];for(let s=0;s<r;s++)l.push((0,y.jsx)("div",{className:"bg-gray-50 h-28 border border-gray-200"},"empty-".concat(s)));for(let o=1;o<=e;o++){const e=new Date(s.getFullYear(),s.getMonth(),o),t=h(e),r=e.toDateString()===g.toDateString(),d=(null===a||void 0===a?void 0:a.toDateString())===e.toDateString(),x=e.toISOString().split("T")[0],b=u===x;l.push((0,y.jsxs)(f.E.div,{layout:!0,onClick:()=>{i(e),m(b?null:x)},className:"\n            min-h-28 border border-gray-200 p-2 cursor-pointer transition-all\n            ".concat(r?"bg-blue-50 border-blue-300":"bg-white","\n            ").concat(d?"ring-2 ring-inset ring-purple-500":"","\n            ").concat(b?"lg:row-span-2":"","\n            hover:bg-gray-50\n          "),whileHover:{scale:1.02},children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,y.jsx)("div",{className:"text-sm font-bold ".concat(r?"text-blue-600":"text-gray-900"),children:o}),t.length>0&&(0,y.jsx)("div",{className:"text-xs font-semibold bg-purple-200 text-purple-900 px-1.5 py-0.5 rounded-full",children:t.length})]}),t.length>0&&(0,y.jsxs)("div",{className:"flex gap-1 flex-wrap mb-1",children:[t.slice(0,3).map((e=>(0,y.jsx)(f.E.div,{layoutId:"event-".concat(e.id),onClick:t=>{t.stopPropagation(),c(e)},className:"\n                    w-2 h-2 rounded-full cursor-pointer\n                    ".concat(p(e),"\n                    hover:w-3 hover:h-3\n                  "),title:e.title,whileHover:{scale:1.5}},e.id))),t.length>3&&(0,y.jsxs)("div",{className:"text-xs text-gray-600",children:["+",t.length-3]})]}),b&&t.length>0&&(0,y.jsx)(f.E.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"border-t border-gray-200 mt-2 pt-2 space-y-1",children:t.map((e=>(0,y.jsxs)(f.E.div,{onClick:t=>{t.stopPropagation(),c(e)},className:"text-xs p-1 rounded cursor-pointer truncate ".concat(v(e.status)," hover:shadow-md transition-shadow"),whileHover:{scale:1.05},children:[(0,y.jsx)("div",{className:"font-semibold truncate",children:e.title}),e.type===n.INCIDENT&&e.incidentData&&(0,y.jsxs)("div",{className:"text-xs opacity-75",children:["\ud83d\udea8 ",e.incidentData.severity]})]},e.id)))})]},o))}return l})()})]}),"week"===d&&(()=>{const e=new Date(s);e.setDate(e.getDate()-e.getDay());const t=[];for(let s=0;s<7;s++){const a=new Date(e);a.setDate(a.getDate()+s),t.push(a)}return(0,y.jsx)("div",{className:"grid grid-cols-7 gap-2",children:t.map(((e,t)=>{const s=h(e),a=e.toDateString()===g.toDateString();return(0,y.jsxs)(f.E.div,{onClick:()=>i(e),className:"\n                rounded-lg p-3 cursor-pointer transition-all\n                ".concat(a?"bg-blue-100 border-2 border-blue-500":"bg-white border border-gray-200","\n                hover:shadow-md\n              "),whileHover:{scale:1.05},children:[(0,y.jsxs)("div",{className:"text-center mb-3",children:[(0,y.jsx)("div",{className:"text-xs font-bold text-gray-600",children:x[e.getDay()]}),(0,y.jsx)("div",{className:"text-lg font-bold text-gray-900",children:e.getDate()})]}),(0,y.jsxs)("div",{className:"space-y-1",children:[s.slice(0,2).map((e=>(0,y.jsx)(f.E.div,{onClick:t=>{t.stopPropagation(),c(e)},className:"text-xs p-1.5 rounded cursor-pointer truncate ".concat(v(e.status)," hover:shadow-sm"),whileHover:{scale:1.05},children:(0,y.jsx)("div",{className:"font-semibold truncate",children:e.title})},e.id))),s.length>2&&(0,y.jsxs)("div",{className:"text-xs text-gray-600 px-1",children:["+",s.length-2," more"]})]})]},t)}))})})(),t.length>0&&(0,y.jsxs)(f.E.div,{initial:{opacity:0},animate:{opacity:1},className:"mt-6 pt-6 border-t border-gray-200 grid grid-cols-3 gap-4 text-sm",children:[(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:t.length}),(0,y.jsx)("div",{className:"text-gray-600",children:"Total Events"})]}),(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:t.filter((e=>e.type===n.ACTIVITY)).length}),(0,y.jsx)("div",{className:"text-gray-600",children:"Activities"})]}),(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"text-2xl font-bold text-red-600",children:t.filter((e=>e.type===n.INCIDENT)).length}),(0,y.jsx)("div",{className:"text-gray-600",children:"Incidents"})]})]})]})},V=s(99724),F=s(95818);var Z=new class{async createEvent(e,t){try{var s;if(!(null===(s=t.title)||void 0===s?void 0:s.trim()))throw new Error("Event title required");const a=new Date,r={title:t.title.trim(),description:t.description||"",type:t.type,category:t.category,context:t.context,visibility:t.visibility||[t.context],dateTime:t.dateTime?V.EK.fromDate(t.dateTime):V.EK.fromDate(a),endDateTime:t.endDateTime?V.EK.fromDate(t.endDateTime):null,location:t.location||"",organizer:e,status:o.PLANNED,tags:t.tags||[],createdAt:V.EK.fromDate(a),updatedAt:V.EK.fromDate(a),createdBy:e,lastModifiedBy:e,roles:[],assistanceRequests:[],polls:[],comments:[],statusHistory:[],escalationPath:[],auditTrail:[],customData:{}};if(t.type===n.INCIDENT){const e=t;r.incidentData={category:t.category,severity:e.severity||l.MEDIUM,description:t.description||"",location:t.location,currentLevel:t.context,assignedResponders:[],escalationPath:[]}}t.type===n.ACTIVITY&&(r.activityData={category:t.category,recurring:t.recurring});const i=(await(0,V.ET)((0,V.hJ)(this.db,this.eventsCollection),r)).id,u={userId:e,role:c.ORGANIZER,permissions:O[c.ORGANIZER],status:d.ACCEPTED,assignedAt:a};if(await this.assignRole(e,i,u),await this.logAuditEntry(e,i,v.CREATED,t.context,{type:t.type,category:t.category}),t.type===n.INCIDENT){if(function(e,t){const s=k[e];if(!s)return!1;const a=["individual","family","community","professional"],n=a.indexOf(t);return a.indexOf(s.escalateTo)>n}(t.severity,t.context)){const s=function(e){const t=["individual","family","community","professional"],s=t.indexOf(e);return-1===s||s===t.length-1?null:t[s+1]}(t.context);s&&await this.escalateIncident(e,i,s,"Auto-escalated due to severity")}}return await this.getEvent(e,i)}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error",code:"CREATE_ERROR",timestamp:new Date}}}async getEvent(e,t){try{const s=await(0,V.QT)((0,V.JU)(this.db,this.eventsCollection,t));if(!s.exists())throw new Error("Event not found");const a=this.convertDocToEvent(t,s.data());if(!this.userCanViewEvent(e,a))throw new Error("Access denied");return{success:!0,data:a,timestamp:new Date}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error",code:"READ_ERROR",timestamp:new Date}}}async queryEvents(e,t,s){try{var a,n;const r=[];(null===(a=t.context)||void 0===a?void 0:a.length)&&r.push((0,V.ar)("visibility","array-contains-any",t.context)),t.type&&r.push((0,V.ar)("type","==",t.type)),(null===(n=t.status)||void 0===n?void 0:n.length)&&r.push((0,V.ar)("status","in",t.status));const i=s.sortBy||"dateTime",l="asc"===s.sortOrder?"asc":"desc";r.push((0,V.Xo)(i,l)),r.push((0,V.b9)(s.pageSize+1));const o=(0,V.IO)((0,V.hJ)(this.db,this.eventsCollection),...r),c=await(0,V.PL)(o),d=c.docs.map((e=>this.convertDocToEvent(e.id,e.data()))).filter((t=>this.userCanViewEvent(e,t))).slice(0,s.pageSize);return{success:!0,data:{items:d,total:d.length,pageSize:s.pageSize,currentPage:s.page,totalPages:Math.ceil(d.length/s.pageSize),hasNextPage:c.docs.length>s.pageSize,hasPrevPage:s.page>1},timestamp:new Date}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error",code:"QUERY_ERROR",timestamp:new Date}}}async updateEvent(e,t){try{const s=await this.getEvent(e,t.id);if(!s.success)throw new Error("Event not found");const a=s.data;if(!this.userHasEventPermission(e,a,u.EDIT))throw new Error("Permission denied");const n={updatedAt:V.EK.fromDate(new Date),lastModifiedBy:e};return t.title&&(n.title=t.title),void 0!==t.description&&(n.description=t.description),t.category&&(n.category=t.category),t.dateTime&&(n.dateTime=V.EK.fromDate(t.dateTime)),void 0!==t.location&&(n.location=t.location),t.tags&&(n.tags=t.tags),t.customData&&(n.customData=t.customData),t.status&&t.status!==a.status&&(n.status=t.status,n.statusHistory=[...a.statusHistory||[],{from:a.status,to:t.status,changedBy:e,changedAt:V.EK.fromDate(new Date),reason:t.resolutionNotes}],t.status===o.RESOLVED&&(n.resolvedAt=V.EK.fromDate(new Date),n.resolvedBy=e,n.resolutionNotes=t.resolutionNotes)),await(0,V.r7)((0,V.JU)(this.db,this.eventsCollection,t.id),n),await this.logAuditEntry(e,t.id,v.UPDATED,a.context,{}),await this.getEvent(e,t.id)}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error",code:"UPDATE_ERROR",timestamp:new Date}}}async deleteEvent(e,t){try{const s=await this.getEvent(e,t);if(!s.success)throw new Error("Event not found");const a=s.data;if(!this.userHasEventPermission(e,a,u.ARCHIVE))throw new Error("Permission denied");return await(0,V.r7)((0,V.JU)(this.db,this.eventsCollection,t),{status:o.ARCHIVED,updatedAt:V.EK.fromDate(new Date),lastModifiedBy:e}),{success:!0,data:null,timestamp:new Date}}catch(s){return{success:!1,error:s instanceof Error?s.message:"Unknown error",code:"DELETE_ERROR",timestamp:new Date}}}async assignRole(e,t,s){try{const a=await this.getEvent(e,t);if(!a.success)throw new Error("Event not found");const n=a.data;if(n.roles.length>1&&!this.userHasEventPermission(e,n,u.ASSIGN_ROLES))throw new Error("Permission denied");const r={id:"role_".concat(Date.now()),eventId:t,...s},i=[...n.roles||[],r];return await(0,V.r7)((0,V.JU)(this.db,this.eventsCollection,t),{roles:i,updatedAt:V.EK.fromDate(new Date),lastModifiedBy:e}),await this.logAuditEntry(e,t,v.ASSIGNED_ROLE,n.context,{assignedTo:s.userId,role:s.role}),{success:!0,data:r,timestamp:new Date}}catch(a){return{success:!1,error:a instanceof Error?a.message:"Unknown error",code:"ASSIGN_ROLE_ERROR",timestamp:new Date}}}async respondToRole(e,t,s,a,n){try{const r=await this.getEvent(e,t);if(!r.success)throw new Error("Event not found");const i=r.data,l=i.roles.find((e=>e.id===s));if(!l)throw new Error("Role not found");if(l.userId!==e)throw new Error("Not your role");const o={...l,status:a?d.ACCEPTED:d.DECLINED,acceptedAt:a?new Date:void 0,notes:n},c=i.roles.map((e=>e.id===s?o:e));return await(0,V.r7)((0,V.JU)(this.db,this.eventsCollection,t),{roles:c,updatedAt:V.EK.fromDate(new Date)}),await this.logAuditEntry(e,t,v.RESPONDED_ROLE,i.context,{response:a?"accepted":"declined"}),{success:!0,data:o,timestamp:new Date}}catch(r){return{success:!1,error:r instanceof Error?r.message:"Unknown error",code:"RESPOND_ROLE_ERROR",timestamp:new Date}}}async escalateIncident(e,t,s,a){try{const n=await this.getEvent(e,t);if(!n.success)throw new Error("Event not found");const r=n.data;if(!P(r))throw new Error("Not an incident");if(!this.userHasEventPermission(e,r,u.ESCALATE))throw new Error("Permission denied");const i={id:"escalation_".concat(Date.now()),eventId:t,fromLevel:r.context,toLevel:s,reason:a,action:p.MANUAL_ESCALATE,escalatedBy:e,escalatedAt:V.EK.fromDate(new Date)},l=[...r.escalationPath||[],i];return await(0,V.r7)((0,V.JU)(this.db,this.eventsCollection,t),{escalationPath:l,updatedAt:V.EK.fromDate(new Date),lastModifiedBy:e,"incidentData.currentLevel":s,"incidentData.escalationPath":l}),await this.logAuditEntry(e,t,v.ESCALATED,r.context,{escalatedTo:s,reason:a}),await this.getEvent(e,t)}catch(n){return{success:!1,error:n instanceof Error?n.message:"Unknown error",code:"ESCALATE_ERROR",timestamp:new Date}}}async linkEntityToEvent(e,t,s,a,n){try{var r;const i=await this.getEvent(e,t);if(!i.success)throw new Error("Event not found");const l=i.data,o="".concat(s,"s"),c=(null===(r=l.customData)||void 0===r?void 0:r[o])||[],d={type:s,entityId:a,linkType:n||"associated",linkedAt:V.EK.fromDate(new Date),linkedBy:e};return await(0,V.r7)((0,V.JU)(this.db,this.eventsCollection,t),{customData:{...l.customData||{},[o]:[...c,d]},updatedAt:V.EK.fromDate(new Date),lastModifiedBy:e}),await this.getEvent(e,t)}catch(i){return{success:!1,error:i instanceof Error?i.message:"Unknown error",code:"LINK_ERROR",timestamp:new Date}}}subscribeToEvent(e,t,s,a){return(0,V.cf)((0,V.JU)(this.db,this.eventsCollection,t),(t=>{if(t.exists()){const a=this.convertDocToEvent(t.id,t.data());this.userCanViewEvent(e,a)&&s(a)}else s(null)}),(e=>null===a||void 0===a?void 0:a(e)))}subscribeToEvents(e,t,s,a){var n,r;const i=[];(null===(n=t.context)||void 0===n?void 0:n.length)&&i.push((0,V.ar)("visibility","array-contains-any",t.context)),t.type&&i.push((0,V.ar)("type","==",t.type)),(null===(r=t.status)||void 0===r?void 0:r.length)&&i.push((0,V.ar)("status","in",t.status)),i.push((0,V.Xo)("dateTime","desc")),i.push((0,V.b9)(50));return(0,V.cf)((0,V.IO)((0,V.hJ)(this.db,this.eventsCollection),...i),(t=>{const a=t.docs.map((e=>this.convertDocToEvent(e.id,e.data()))).filter((t=>this.userCanViewEvent(e,t)));s(a)}),(e=>null===a||void 0===a?void 0:a(e)))}convertDocToEvent(e,t){var s,a,n,r,i,l,o,c,d,u;return{id:e,...t,dateTime:(null===(a=t.dateTime)||void 0===a||null===(s=a.toDate)||void 0===s?void 0:s.call(a))||t.dateTime||new Date,endDateTime:(null===(r=t.endDateTime)||void 0===r||null===(n=r.toDate)||void 0===n?void 0:n.call(r))||t.endDateTime,createdAt:(null===(l=t.createdAt)||void 0===l||null===(i=l.toDate)||void 0===i?void 0:i.call(l))||t.createdAt||new Date,updatedAt:(null===(c=t.updatedAt)||void 0===c||null===(o=c.toDate)||void 0===o?void 0:o.call(c))||t.updatedAt||new Date,resolvedAt:(null===(u=t.resolvedAt)||void 0===u||null===(d=u.toDate)||void 0===d?void 0:d.call(u))||t.resolvedAt,escalationPath:(t.escalationPath||[]).map((e=>{var t,s;return{...e,escalatedAt:(null===(s=e.escalatedAt)||void 0===s||null===(t=s.toDate)||void 0===t?void 0:t.call(s))||e.escalatedAt}})),auditTrail:(t.auditTrail||[]).map((e=>{var t,s;return{...e,timestamp:(null===(s=e.timestamp)||void 0===s||null===(t=s.toDate)||void 0===t?void 0:t.call(s))||e.timestamp}})),statusHistory:(t.statusHistory||[]).map((e=>{var t,s;return{...e,changedAt:(null===(s=e.changedAt)||void 0===s||null===(t=s.toDate)||void 0===t?void 0:t.call(s))||e.changedAt}}))}}userCanViewEvent(e,t){var s;return t.organizer===e||!!(null===(s=t.roles)||void 0===s?void 0:s.some((t=>t.userId===e)))}userHasEventPermission(e,t,s){var a;const n=null===(a=t.roles)||void 0===a?void 0:a.find((t=>t.userId===e));return(null===n||void 0===n?void 0:n.permissions.includes(s))||!1}async logAuditEntry(e,t,s,a,n){try{await(0,V.ET)((0,V.hJ)(this.db,this.auditCollection),{eventId:t,userId:e,action:s,context:a,timestamp:V.EK.fromDate(new Date),details:n})}catch(r){}}constructor(){this.eventsCollection="events",this.pollsCollection="polls",this.assistanceRequestsCollection="assistanceRequests",this.auditCollection="auditLogs",this.db=F.db}};var Y=e=>{let{userId:t,initialEvent:s,defaultContext:o=a.INDIVIDUAL,onSuccess:c,onCancel:d,mode:u="quick"}=e;const[m,x]=(0,b.useState)(u),[h,g]=(0,b.useState)(!1),[p,v]=(0,b.useState)(null),[f,j]=(0,b.useState)(null),[N,E]=(0,b.useState)((null===s||void 0===s?void 0:s.type)||n.ACTIVITY),[w,D]=(0,b.useState)((null===s||void 0===s?void 0:s.title)||""),[C,T]=(0,b.useState)((null===s||void 0===s?void 0:s.description)||""),[I,A]=(0,b.useState)((null===s||void 0===s?void 0:s.category)||r.MEETING),[S,R]=(0,b.useState)((null===s||void 0===s?void 0:s.context)||o),[O,k]=(0,b.useState)((null===s||void 0===s?void 0:s.dateTime)?s.dateTime.toISOString().split("T")[0]:(new Date).toISOString().split("T")[0]),[P,L]=(0,b.useState)("09:00"),[_,M]=(0,b.useState)((null===s||void 0===s?void 0:s.location)||""),[U,H]=(0,b.useState)(l.MEDIUM),[V,F]=(0,b.useState)(""),[Y,G]=(0,b.useState)(!1),[B,K]=(0,b.useState)("weekly"),q=N===n.ACTIVITY?Object.values(r):Object.values(i),z=async e=>{e.preventDefault(),v(null),g(!0);try{const e=new Date("".concat(O,"T").concat(P,":00"));if(null===s||void 0===s?void 0:s.id){const a={id:s.id,title:w,description:C,category:I,dateTime:e,location:_},n=await Z.updateEvent(t,a);if(!n.success)throw new Error(n.error);j("Event updated successfully"),null===c||void 0===c||c(n.data)}else{const s={title:w,description:C,type:N,category:I,context:S,dateTime:e,location:_,tags:[]};N===n.INCIDENT&&(s.severity=U,V&&(s.injuries=V)),N===n.ACTIVITY&&Y&&(s.recurring={frequency:B,interval:1});const a=await Z.createEvent(t,s);if(!a.success)throw new Error(a.error);j("Event created successfully"),D(""),T(""),M(""),null===c||void 0===c||c(a.data)}}catch(a){const e=a instanceof Error?a.message:"Unknown error";v(e)}finally{g(!1)}};return"quick"===m?(0,y.jsxs)("form",{onSubmit:z,className:"space-y-4 p-4 bg-white rounded-lg shadow",children:[(0,y.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Quick Add Event"}),p&&(0,y.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm",children:p}),f&&(0,y.jsx)("div",{className:"p-3 bg-green-50 border border-green-200 rounded text-green-700 text-sm",children:f}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,y.jsx)("input",{type:"text",value:w,onChange:e=>D(e.target.value),placeholder:"Event title",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type"}),(0,y.jsxs)("select",{value:N,onChange:e=>{E(e.target.value),A(N===n.ACTIVITY?r.MEETING:i.HEALTH)},className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,y.jsx)("option",{value:n.ACTIVITY,children:"Activity"}),(0,y.jsx)("option",{value:n.INCIDENT,children:"Incident"})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),(0,y.jsx)("select",{value:I,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:q.map((e=>(0,y.jsx)("option",{value:e,children:e.replace(/_/g," ").toUpperCase()},e)))})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date"}),(0,y.jsx)("input",{type:"date",value:O,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time"}),(0,y.jsx)("input",{type:"time",value:P,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Context"}),(0,y.jsx)("select",{value:S,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.values(a).map((e=>(0,y.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]}),N===n.INCIDENT&&(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Severity"}),(0,y.jsx)("select",{value:U,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.values(l).map((e=>(0,y.jsx)("option",{value:e,children:e.toUpperCase()},e)))})]})]}),(0,y.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,y.jsx)("button",{type:"button",onClick:()=>x("advanced"),className:"px-4 py-2 text-blue-600 hover:bg-blue-50 rounded font-medium",children:"Advanced"}),(0,y.jsx)("button",{type:"button",onClick:d,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded font-medium",children:"Cancel"}),(0,y.jsx)("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded font-medium hover:bg-blue-700 disabled:opacity-50",children:h?"Creating...":"Create Event"})]})]}):(0,y.jsxs)("form",{onSubmit:z,className:"space-y-6 p-6 bg-white rounded-lg shadow max-w-2xl",children:[(0,y.jsxs)("div",{className:"flex justify-between items-center",children:[(0,y.jsx)("h3",{className:"text-lg font-bold text-gray-800",children:"Advanced Event Editor"}),(0,y.jsx)("button",{type:"button",onClick:()=>x("quick"),className:"text-sm text-gray-500 hover:text-gray-700",children:"\u2190 Quick Mode"})]}),p&&(0,y.jsx)("div",{className:"p-3 bg-red-50 border border-red-200 rounded text-red-700 text-sm",children:p}),(0,y.jsxs)("section",{children:[(0,y.jsx)("h4",{className:"font-semibold text-gray-700 mb-4",children:"Basic Information"}),(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),(0,y.jsx)("input",{type:"text",value:w,onChange:e=>D(e.target.value),placeholder:"Event title",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),(0,y.jsx)("textarea",{value:C,onChange:e=>T(e.target.value),placeholder:"Event description",rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Type *"}),(0,y.jsxs)("select",{value:N,onChange:e=>E(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,y.jsx)("option",{value:n.ACTIVITY,children:"Activity"}),(0,y.jsx)("option",{value:n.INCIDENT,children:"Incident"})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category *"}),(0,y.jsx)("select",{value:I,onChange:e=>A(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:q.map((e=>(0,y.jsx)("option",{value:e,children:e.replace(/_/g," ").toUpperCase()},e)))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Context *"}),(0,y.jsx)("select",{value:S,onChange:e=>R(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.values(a).map((e=>(0,y.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]})]})]})]}),(0,y.jsxs)("section",{children:[(0,y.jsx)("h4",{className:"font-semibold text-gray-700 mb-4",children:"Timing"}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Date *"}),(0,y.jsx)("input",{type:"date",value:O,onChange:e=>k(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Time"}),(0,y.jsx)("input",{type:"time",value:P,onChange:e=>L(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),N===n.ACTIVITY&&(0,y.jsxs)("div",{className:"mt-4 flex items-center gap-4",children:[(0,y.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,y.jsx)("input",{type:"checkbox",checked:Y,onChange:e=>G(e.target.checked),className:"w-4 h-4"}),(0,y.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Recurring"})]}),Y&&(0,y.jsxs)("select",{value:B,onChange:e=>K(e.target.value),className:"px-3 py-1 text-sm border border-gray-300 rounded",children:[(0,y.jsx)("option",{value:"daily",children:"Daily"}),(0,y.jsx)("option",{value:"weekly",children:"Weekly"}),(0,y.jsx)("option",{value:"monthly",children:"Monthly"})]})]})]}),(0,y.jsxs)("section",{children:[(0,y.jsx)("h4",{className:"font-semibold text-gray-700 mb-4",children:"Details"}),(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Location"}),(0,y.jsx)("input",{type:"text",value:_,onChange:e=>M(e.target.value),placeholder:"Event location",className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),N===n.INCIDENT&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Severity *"}),(0,y.jsx)("select",{value:U,onChange:e=>H(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500",children:Object.values(l).map((e=>(0,y.jsx)("option",{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e)))})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Injuries/Damage"}),(0,y.jsx)("textarea",{value:V,onChange:e=>F(e.target.value),placeholder:"Describe any injuries or damage",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]})]}),(0,y.jsxs)("div",{className:"flex gap-2 justify-end pt-4 border-t",children:[(0,y.jsx)("button",{type:"button",onClick:d,className:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded font-medium",children:"Cancel"}),(0,y.jsx)("button",{type:"submit",disabled:h,className:"px-4 py-2 bg-blue-600 text-white rounded font-medium hover:bg-blue-700 disabled:opacity-50",children:h?"Saving...":s?"Update Event":"Create Event"})]})]})};var G=e=>{let{event:t,onEdit:s,onEscalate:n,onResolve:r}=e;var i,c,d;const[u,m]=(0,b.useState)("overview"),x=e=>e?new Date(e).toLocaleString():"N/A",h={[o.PLANNED]:"bg-blue-100 text-blue-800",[o.OPEN]:"bg-yellow-100 text-yellow-800",[o.IN_PROGRESS]:"bg-purple-100 text-purple-800",[o.RESOLVED]:"bg-green-100 text-green-800",[o.ARCHIVED]:"bg-gray-100 text-gray-800"},g={[l.CRITICAL]:"bg-red-100 text-red-800 border-l-4 border-red-500",[l.HIGH]:"bg-orange-100 text-orange-800 border-l-4 border-orange-500",[l.MEDIUM]:"bg-yellow-100 text-yellow-800 border-l-4 border-yellow-500",[l.LOW]:"bg-green-100 text-green-800 border-l-4 border-green-500"},p=e=>{let{id:t,title:s,children:a}=e;return(0,y.jsxs)("div",{className:"border-b",children:[(0,y.jsxs)("button",{onClick:()=>m(u===t?null:t),className:"w-full flex justify-between items-center p-4 hover:bg-gray-50 font-semibold text-gray-700",children:[s,(0,y.jsx)("span",{children:u===t?"\u25bc":"\u25b6"})]}),u===t&&(0,y.jsx)("div",{className:"px-4 pb-4 bg-gray-50",children:a})]})};return(0,y.jsxs)("div",{className:"bg-white rounded-lg shadow-lg max-w-2xl mx-auto",children:[(0,y.jsx)("div",{className:"p-6 bg-gradient-to-r from-blue-600 to-blue-700 text-white",children:(0,y.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h2",{className:"text-2xl font-bold mb-2",children:t.title}),(0,y.jsxs)("div",{className:"flex gap-2",children:[(0,y.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(h[t.status]),children:t.status.toUpperCase()}),P(t)&&(null===(i=t.incidentData)||void 0===i?void 0:i.severity)&&(0,y.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(g[t.incidentData.severity]),children:t.incidentData.severity.toUpperCase()})]})]}),(0,y.jsx)("div",{className:"text-right",children:(0,y.jsx)("button",{onClick:s,className:"px-4 py-2 bg-white text-blue-600 rounded hover:bg-gray-100 font-medium text-sm",children:"Edit"})})]})}),(0,y.jsxs)("div",{className:"divide-y",children:[(0,y.jsx)(p,{id:"overview",title:"Overview",children:(0,y.jsxs)("div",{className:"space-y-3",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Description"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1",children:t.description||"No description"})]}),(0,y.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Date & Time"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1",children:x(t.dateTime)})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Location"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1",children:t.location||"No location"})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Type"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1",children:t.type.toUpperCase()})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Category"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1",children:String(t.category).replace(/_/g," ").toUpperCase()})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Context"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1",children:t.context.toUpperCase()})]})]})]})}),(0,y.jsx)(p,{id:"roles",title:"Roles (".concat((null===(c=t.roles)||void 0===c?void 0:c.length)||0,")"),children:(0,y.jsx)("div",{className:"space-y-3",children:t.roles&&t.roles.length>0?t.roles.map((e=>(0,y.jsxs)("div",{className:"p-3 bg-white border border-gray-200 rounded",children:[(0,y.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"font-medium text-gray-800",children:e.role}),(0,y.jsxs)("p",{className:"text-sm text-gray-600",children:["User: ",e.userId]})]}),(0,y.jsx)("span",{className:"text-xs font-medium px-2 py-1 rounded ".concat("accepted"===e.status?"bg-green-100 text-green-800":"declined"===e.status?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"),children:e.status})]}),e.notes&&(0,y.jsxs)("p",{className:"text-sm text-gray-600",children:["Notes: ",e.notes]})]},e.id))):(0,y.jsx)("p",{className:"text-gray-500 text-sm",children:"No roles assigned"})})}),P(t)&&t.incidentData&&(0,y.jsx)(p,{id:"incident",title:"Incident Details",children:(0,y.jsxs)("div",{className:"space-y-3",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Severity"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1 font-semibold",children:null===(d=t.incidentData.severity)||void 0===d?void 0:d.toUpperCase()})]}),t.incidentData.injuries&&(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Injuries/Damage"}),(0,y.jsx)("p",{className:"text-gray-800 mt-1",children:t.incidentData.injuries})]}),t.incidentData.assignedResponders&&t.incidentData.assignedResponders.length>0&&(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-sm font-medium text-gray-600",children:"Assigned Responders"}),(0,y.jsx)("div",{className:"mt-1 flex flex-wrap gap-2",children:t.incidentData.assignedResponders.map((e=>(0,y.jsx)("span",{className:"bg-blue-100 text-blue-800 text-sm px-2 py-1 rounded",children:e},e)))})]})]})}),t.escalationPath&&t.escalationPath.length>0&&(0,y.jsx)(p,{id:"escalation",title:"Escalation History",children:(0,y.jsx)("div",{className:"space-y-3",children:t.escalationPath.map(((e,t)=>{var s,a;return(0,y.jsx)("div",{className:"p-3 bg-white border border-gray-200 rounded",children:(0,y.jsxs)("div",{className:"flex justify-between items-start",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("p",{className:"font-medium text-gray-800",children:[null===(s=e.fromLevel)||void 0===s?void 0:s.toUpperCase()," \u2192 ",null===(a=e.toLevel)||void 0===a?void 0:a.toUpperCase()]}),(0,y.jsxs)("p",{className:"text-sm text-gray-600",children:["By: ",e.escalatedBy]}),(0,y.jsxs)("p",{className:"text-sm text-gray-600",children:["Reason: ",e.reason]})]}),(0,y.jsx)("p",{className:"text-xs text-gray-500",children:x(e.escalatedAt)})]})},e.id||t)}))})}),t.customData&&Object.keys(t.customData).length>0&&(0,y.jsx)(p,{id:"links",title:"Linked Items",children:(0,y.jsx)("div",{className:"space-y-4",children:["contacts","assets","projects","timelines"].map((e=>{var s;const a=(null===(s=t.customData)||void 0===s?void 0:s[e])||[];return 0===a.length?null:(0,y.jsxs)("div",{children:[(0,y.jsx)("h4",{className:"font-medium text-gray-700 mb-2 capitalize",children:e}),(0,y.jsx)("div",{className:"flex flex-wrap gap-2",children:a.map(((e,t)=>(0,y.jsxs)("span",{className:"bg-gray-100 text-gray-800 text-sm px-3 py-1 rounded border border-gray-300",children:[e.entityId," (",e.linkType,")"]},t)))})]},e)}))})}),(0,y.jsx)(p,{id:"metadata",title:"Metadata",children:(0,y.jsxs)("div",{className:"space-y-3 text-sm",children:[(0,y.jsxs)("div",{className:"grid grid-cols-2",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-gray-600 font-medium",children:"Created"}),(0,y.jsx)("p",{className:"text-gray-800",children:x(t.createdAt)})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-gray-600 font-medium",children:"By"}),(0,y.jsx)("p",{className:"text-gray-800",children:t.createdBy})]})]}),(0,y.jsxs)("div",{className:"grid grid-cols-2",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-gray-600 font-medium",children:"Updated"}),(0,y.jsx)("p",{className:"text-gray-800",children:x(t.updatedAt)})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-gray-600 font-medium",children:"By"}),(0,y.jsx)("p",{className:"text-gray-800",children:t.lastModifiedBy})]})]}),t.resolvedAt&&(0,y.jsxs)("div",{className:"grid grid-cols-2",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-gray-600 font-medium",children:"Resolved"}),(0,y.jsx)("p",{className:"text-gray-800",children:x(t.resolvedAt)})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"text-gray-600 font-medium",children:"By"}),(0,y.jsx)("p",{className:"text-gray-800",children:t.resolvedBy})]})]})]})})]}),(0,y.jsx)("div",{className:"p-4 bg-gray-50 border-t flex gap-2 justify-end",children:P(t)&&t.status!==o.RESOLVED&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:()=>null===n||void 0===n?void 0:n(a.FAMILY),className:"px-4 py-2 bg-orange-600 text-white rounded hover:bg-orange-700 font-medium text-sm",children:"Escalate"}),(0,y.jsx)("button",{onClick:r,className:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 font-medium text-sm",children:"Resolve"})]})})]})},B=s(86501);var K=()=>{const{user:e}=(0,D.a)(),[t,s]=(0,b.useState)(a.FAMILY),[n,r]=(0,b.useState)([]),[i,l]=(0,b.useState)(new Date),[c,d]=(0,b.useState)(null),[u,m]=(0,b.useState)(null),[x,h]=(0,b.useState)(!1),[g,p]=(0,b.useState)(!1),[v,T]=(0,b.useState)(null),[I,A]=(0,b.useState)(!0),[S,R]=(0,b.useState)(null),[O,k]=(0,b.useState)("month");(0,b.useEffect)((()=>{{const e=localStorage.getItem("calendar-context");e&&s(e)}}),[]),(0,b.useEffect)((()=>{if(!(null===e||void 0===e?void 0:e.id))return void A(!1);A(!0);let s=null;return(async()=>{try{s=Z.subscribeToEvents(e.id,{context:[t]},(e=>{r(e),R(null),A(!1)}),(e=>{R("Failed to load events"),A(!1)}))}catch(a){R("Failed to set up calendar subscription"),A(!1)}})(),()=>{s&&s()}}),[null===e||void 0===e?void 0:e.id,t]);return I&&0===n.length?(0,y.jsx)(C.Z,{title:"Calendar",children:(0,y.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,y.jsxs)("div",{className:"text-center space-y-4",children:[(0,y.jsx)(j.Z,{className:"w-12 h-12 animate-spin mx-auto text-purple-500"}),(0,y.jsx)("p",{className:"text-gray-600",children:"Loading calendar events..."})]})})}):S&&0===n.length?(0,y.jsx)(C.Z,{title:"Calendar",children:(0,y.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,y.jsxs)("div",{className:"text-center space-y-4",children:[(0,y.jsx)(N.Z,{className:"w-12 h-12 mx-auto text-red-500"}),(0,y.jsx)("p",{className:"text-red-600 font-semibold",children:"Error loading calendar"}),(0,y.jsx)("p",{className:"text-gray-600 text-sm",children:S})]})})}):(0,y.jsx)(C.Z,{title:"Calendar",children:(0,y.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white",children:(0,y.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,y.jsxs)(f.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 flex items-center gap-3",children:[(0,y.jsx)(E.Z,{className:"w-8 h-8 text-purple-600"}),"Calendar"]}),(0,y.jsx)("p",{className:"text-gray-600 mt-1",children:"Manage events and activities across multiple contexts"})]}),(0,y.jsxs)(f.E.button,{onClick:()=>{T(null),h(!0)},whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg flex items-center gap-2 transition-colors",children:[(0,y.jsx)(w.Z,{className:"w-5 h-5"}),"Add Event"]})]}),(0,y.jsxs)("div",{className:"mb-6",children:[(0,y.jsx)("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"Filter by context:"}),(0,y.jsx)(_,{current:t,onChange:s})]}),(0,y.jsx)("div",{className:"flex gap-2",children:["month","week"].map((e=>(0,y.jsxs)(f.E.button,{onClick:()=>k(e),whileHover:{scale:1.05},whileTap:{scale:.95},className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat(O===e?"bg-purple-600 text-white":"bg-white text-gray-900 border border-gray-200 hover:bg-gray-50"),children:[e.charAt(0).toUpperCase()+e.slice(1)," View"]},e)))})]}),(0,y.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6",children:[(0,y.jsx)(f.E.div,{initial:{opacity:0},animate:{opacity:1},className:"lg:col-span-3",children:(0,y.jsx)(H,{events:n,currentMonth:i,selectedDate:c,onMonthChange:l,onDateSelect:d,onEventSelect:e=>{m(e),p(!0)},viewMode:O})}),(0,y.jsxs)(f.E.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"space-y-6",children:[(0,y.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,y.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:"Current Context"}),(0,y.jsxs)("p",{className:"text-sm text-gray-600 capitalize mb-4",children:["Viewing events in ",(0,y.jsx)("strong",{children:t.toLowerCase()})," context"]}),(0,y.jsxs)("div",{className:"text-sm space-y-2",children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"font-medium text-gray-900",children:"Total Events:"}),(0,y.jsx)("span",{className:"ml-2 text-gray-600",children:n.length})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("span",{className:"font-medium text-gray-900",children:"Selected Date:"}),(0,y.jsx)("span",{className:"ml-2 text-gray-600",children:c?c.toLocaleDateString():"None"})]})]})]}),c&&(0,y.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,y.jsx)("h3",{className:"font-bold text-gray-900 mb-4",children:c.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})}),(0,y.jsxs)("div",{className:"space-y-2",children:[n.filter((e=>new Date(e.dateTime).toDateString()===c.toDateString())).slice(0,5).map((e=>(0,y.jsxs)(f.E.button,{onClick:()=>{m(e),p(!0)},whileHover:{scale:1.05},className:"w-full text-left p-3 bg-gray-50 hover:bg-gray-100 rounded-lg transition-colors",children:[(0,y.jsx)("div",{className:"font-medium text-sm text-gray-900 truncate",children:e.title}),(0,y.jsx)("div",{className:"text-xs text-gray-600 mt-1",children:e.status})]},e.id))),0===n.filter((e=>new Date(e.dateTime).toDateString()===c.toDateString())).length&&(0,y.jsx)("p",{className:"text-sm text-gray-600",children:"No events scheduled"})]})]})]})]}),x&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,y.jsx)(f.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:(0,y.jsx)(Y,{userId:(null===e||void 0===e?void 0:e.id)||"",defaultContext:t,mode:"advanced",initialEvent:v||void 0,onSuccess:()=>h(!1),onCancel:()=>h(!1)})})}),g&&u&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,y.jsxs)(f.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,y.jsx)(G,{event:u,onEdit:()=>{T(u),p(!1),h(!0)},onEscalate:async()=>{if((null===e||void 0===e?void 0:e.id)&&u)try{const t=await Z.escalateIncident(e.id,u.id,a.FAMILY,"Escalated from calendar UI");t.success?(B.ZP.success("Incident escalated successfully!"),m(null)):B.ZP.error(t.error||"Failed to escalate incident")}catch(t){B.ZP.error("Error escalating incident")}else B.ZP.error("Not authenticated or no event selected")},onResolve:()=>{(async(t,s)=>{if((null===e||void 0===e?void 0:e.id)&&u)try{const a=await Z.updateEvent(e.id,{id:t,...s});a.success?(B.ZP.success("Event updated successfully!"),h(!1),m(null)):B.ZP.error(a.error||"Failed to update event")}catch(a){B.ZP.error("Error updating event")}else B.ZP.error("Not authenticated or no event selected")})(u.id,{status:o.RESOLVED})}}),(0,y.jsxs)("div",{className:"border-t border-gray-200 p-6 flex gap-3",children:[(0,y.jsx)("button",{onClick:()=>{T(u),p(!1),h(!0)},className:"flex-1 py-2 px-4 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-medium transition-colors",children:"Edit"}),(0,y.jsx)("button",{onClick:()=>(async t=>{if(null===e||void 0===e?void 0:e.id){if(window.confirm("Are you sure you want to delete this event?"))try{const s=await Z.deleteEvent(e.id,t);s.success?(B.ZP.success("Event deleted successfully!"),p(!1),m(null)):B.ZP.error(s.error||"Failed to delete event")}catch(s){B.ZP.error("Error deleting event")}}else B.ZP.error("Not authenticated")})(u.id),className:"py-2 px-4 bg-red-100 hover:bg-red-200 text-red-900 rounded-lg font-medium transition-colors",children:"Delete"}),(0,y.jsx)("button",{onClick:()=>p(!1),className:"py-2 px-4 bg-gray-100 hover:bg-gray-200 text-gray-900 rounded-lg font-medium transition-colors",children:"Close"})]})]})})]})})})}}},function(e){e.O(0,[2441,2023,6194,2888,9774,179],(function(){return t=53205,e(e.s=t);var t}));var t=e.O();_N_E=t}]);