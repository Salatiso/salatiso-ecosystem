"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7229],{17229:function(t,i,n){n.r(i),n.d(i,{notificationService:function(){return r}});var o=n(95818),e=n(22806),a=n(99724),s=n(34155);const r=new class{async requestPermission(){if(!("Notification"in window))throw new Error("This browser does not support notifications");return await Notification.requestPermission()}async getFCMToken(){try{if(!o.Fw)return null;if("granted"!==await this.requestPermission())return null;return await(0,e.LP)(o.Fw,{vapidKey:this.vapidKey})}catch(t){return null}}async saveTokenToUser(t,i){try{const n=(0,a.JU)(o.db,"users",t);await(0,a.r7)(n,{fcmToken:i,notificationsEnabled:!0,lastTokenUpdate:new Date})}catch(n){throw n}}async removeTokenFromUser(t){try{const i=(0,a.JU)(o.db,"users",t);await(0,a.r7)(i,{fcmToken:null,notificationsEnabled:!1,lastTokenUpdate:new Date})}catch(i){throw i}}initializeForegroundMessages(){o.Fw&&(0,e.ps)(o.Fw,(t=>{const i=t.notification;i&&this.showNotification({title:i.title||"Salatiso Notification",body:i.body||"",icon:i.icon,data:t.data})}))}showNotification(t){if("granted"!==Notification.permission)return;const i={body:t.body,icon:t.icon||"/favicon.ico",badge:t.badge,tag:t.tag,requireInteraction:t.requireInteraction,data:t.data};t.actions&&t.actions.length>0&&(i.actions=t.actions);const n=new Notification(t.title,i);t.requireInteraction||setTimeout((()=>{n.close()}),5e3),n.onclick=()=>{var i;window.focus(),n.close(),(null===(i=t.data)||void 0===i?void 0:i.action)&&this.handleNotificationAction(t.data.action,t.data)},t.actions&&(n.onshow=()=>{})}handleNotificationAction(t,i){switch(t){case"view_family_update":window.location.href="/intranet/family?update=".concat(i.updateId);break;case"view_project":window.location.href="/intranet/projects?id=".concat(i.projectId);break;case"view_achievement":window.location.href="/intranet/profile?tab=achievements";break;case"view_announcement":window.location.href="/intranet/announcements?id=".concat(i.announcementId)}}async sendTestNotification(t){try{const i=(0,a.JU)(o.db,"users",t),n=await(0,a.QT)(i);if(!n.exists())throw new Error("User not found");if(!n.data().fcmToken)throw new Error("User has no FCM token");this.showNotification({title:"Test Notification",body:"This is a test push notification from Salatiso!",tag:"test-notification"})}catch(i){throw i}}isSupported(){return"Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window}getPermissionStatus(){return"Notification"in window?Notification.permission:"denied"}constructor(){this.vapidKey=s.env.NEXT_PUBLIC_FIREBASE_VAPID_KEY}};i.default=r}}]);