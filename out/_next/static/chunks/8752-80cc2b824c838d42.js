"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8752],{46060:function(e,t,s){s.d(t,{S:function(){return i}});var n=s(99724),r=s(95818),o=s(80602);const i=new class{async getUserPreferences(e){try{var t;const s=(0,n.JU)(r.db,"users",e),o=await(0,n.QT)(s);if(!o.exists())throw new Error("User not found");const i=null===(t=o.data().preferences)||void 0===t?void 0:t.notifications;return i||this.getDefaultPreferences()}catch(s){throw s}}async updateUserPreferences(e,t){try{const s=(0,n.JU)(r.db,"users",e);await(0,n.r7)(s,{"preferences.notifications":{...this.getDefaultPreferences(),...t,updatedAt:new Date}})}catch(s){throw s}}async setChannelEnabled(e,t,s){try{const n=await this.getUserPreferences(e),r={...n,channels:{...n.channels,[t]:{...n.channels[t],enabled:s}}};await this.updateUserPreferences(e,r)}catch(n){throw n}}async setNotificationTypeEnabled(e,t,s){try{const n=await this.getUserPreferences(e),r={[o.k$.ESCALATION_CREATED]:"escalationCreated",[o.k$.ESCALATION_ASSIGNED]:"escalationAssigned",[o.k$.ESCALATION_ESCALATED]:"escalationEscalated",[o.k$.ESCALATION_RESOLVED]:"escalationResolved",[o.k$.ESCALATION_URGENT]:"escalationUrgent",[o.k$.RESPONSE_DUE]:"responseDue",[o.k$.ASSIGNMENT_ACKNOWLEDGED]:"assignmentAcknowledged",[o.k$.COMMENT_ADDED]:"commentAdded",[o.k$.STATUS_CHANGED]:"statusChanged",[o.k$.CUSTOM]:"escalationCreated"}[t],i={...n,types:{...n.types,[r]:s}};await this.updateUserPreferences(e,i)}catch(n){throw n}}async setQuietHours(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];try{const n=await this.getUserPreferences(e);if(s){const s={...n,globalQuietHours:t};await this.updateUserPreferences(e,s)}else{const s={...n,channels:{web:{...n.channels.web,quietHours:t},email:{...n.channels.email,quietHours:t},sms:{...n.channels.sms,quietHours:t},push:{...n.channels.push,quietHours:t}}};await this.updateUserPreferences(e,s)}}catch(n){throw n}}async isInQuietHours(e,t,s){try{var n,r;const a=await this.getUserPreferences(e);var o;if(null===(n=a.globalQuietHours)||void 0===n?void 0:n.enabled)if(this.isCurrentTimeInQuietHours(a.globalQuietHours)&&(!s||!(null===(o=a.globalQuietHours.exceptions)||void 0===o?void 0:o.includes(s))))return!0;const c=a.channels[t];var i;if(null===c||void 0===c||null===(r=c.quietHours)||void 0===r?void 0:r.enabled)if(this.isCurrentTimeInQuietHours(c.quietHours)&&(!s||!(null===(i=c.quietHours.exceptions)||void 0===i?void 0:i.includes(s))))return!0;return!1}catch(a){return!1}}isCurrentTimeInQuietHours(e){const t=new Date,s="".concat(String(t.getHours()).padStart(2,"0"),":").concat(String(t.getMinutes()).padStart(2,"0")),n=t.getDay();if(!e.daysOfWeek.includes(n))return!1;const r=e.startTime,o=e.endTime;return r<=o?s>=r&&s<=o:s>=r||s<=o}async setDoNotDisturb(e,t){try{const s=await this.getUserPreferences(e),n=new Date,r=new Date(n.getTime()+6e4*t),o={...s,doNotDisturbEnabled:!0,doNotDisturbUntil:r};await this.updateUserPreferences(e,o)}catch(s){throw s}}async disableDoNotDisturb(e){try{const t={...await this.getUserPreferences(e),doNotDisturbEnabled:!1,doNotDisturbUntil:void 0};await this.updateUserPreferences(e,t)}catch(t){throw t}}async isInDoNotDisturb(e){try{const t=await this.getUserPreferences(e);if(!t.doNotDisturbEnabled)return!1;if(t.doNotDisturbUntil){const e=t.doNotDisturbUntil instanceof n.EK?t.doNotDisturbUntil.toDate():new Date(t.doNotDisturbUntil);return new Date<e}return!1}catch(t){return!1}}getDefaultPreferences(){return{channels:{web:{enabled:!0},email:{enabled:!1},sms:{enabled:!1},push:{enabled:!0}},types:{escalationCreated:!0,escalationAssigned:!0,escalationEscalated:!0,escalationResolved:!0,escalationUrgent:!0,responseDue:!0,assignmentAcknowledged:!1,commentAdded:!0,statusChanged:!1},escalationContextNotifications:{health:!0,safety:!0,property:!0,emotional:!0,financial:!0,legal:!0,other:!0},escalationLevelNotifications:{individual:!0,family:!0,community:!0,professional:!0},digestFrequency:"immediate",digestEnabled:!1,doNotDisturbEnabled:!1,soundEnabled:!0,vibrationEnabled:!0,updatedAt:new Date}}async resetToDefaults(e){try{await this.updateUserPreferences(e,this.getDefaultPreferences())}catch(t){throw t}}validatePreferences(e){var t;const s=[];if((null===(t=e.globalQuietHours)||void 0===t?void 0:t.enabled)&&(this.validateQuietHours(e.globalQuietHours)||s.push("Invalid global quiet hours configuration")),Object.entries(e.channels).forEach((e=>{let[t,n]=e;var r;(null===(r=n.quietHours)||void 0===r?void 0:r.enabled)&&(this.validateQuietHours(n.quietHours)||s.push("Invalid quiet hours for ".concat(t," channel")))})),e.doNotDisturbUntil){(e.doNotDisturbUntil instanceof n.EK?e.doNotDisturbUntil.toDate():new Date(e.doNotDisturbUntil))<new Date&&s.push("Do not disturb expiration time must be in the future")}return s}validateQuietHours(e){const t=/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/;return!(!t.test(e.startTime)||!t.test(e.endTime))&&!!e.daysOfWeek.every((e=>e>=0&&e<=6))}};t.Z=i},80602:function(e,t,s){var n,r,o;s.d(t,{RX:function(){return o},dm:function(){return n},k$:function(){return r}}),function(e){e.WEB="web",e.EMAIL="email",e.SMS="sms",e.PUSH="push"}(n||(n={})),function(e){e.ESCALATION_CREATED="escalation_created",e.ESCALATION_ASSIGNED="escalation_assigned",e.ESCALATION_ESCALATED="escalation_escalated",e.ESCALATION_RESOLVED="escalation_resolved",e.ESCALATION_URGENT="escalation_urgent",e.RESPONSE_DUE="response_due",e.ASSIGNMENT_ACKNOWLEDGED="assignment_acknowledged",e.COMMENT_ADDED="comment_added",e.STATUS_CHANGED="status_changed",e.CUSTOM="custom"}(r||(r={})),function(e){e.LOW="low",e.NORMAL="normal",e.HIGH="high",e.CRITICAL="critical"}(o||(o={}))},87783:function(e,t,s){s.r(t),s.d(t,{dismissAllToasts:function(){return f},dismissToast:function(){return d},showError:function(){return a},showInfo:function(){return u},showLoading:function(){return l},showSuccess:function(){return i},showWarning:function(){return c},toastManager:function(){return o},useToast:function(){return h}});var n=s(86501),r=s(96232);const o=new class{success(e,t){return r.kg.info("Toast success shown",{message:e}),n.ZP.success(e,{duration:4e3,style:{background:"#10B981",color:"#fff"},...t})}error(e,t,s){return r.kg.error("Toast error shown",t||new Error(e),{message:e}),n.ZP.error(e,{duration:6e3,style:{background:"#EF4444",color:"#fff"},...s})}warning(e,t){return r.kg.warn("Toast warning shown",{message:e}),(0,n.ZP)(e,{duration:5e3,icon:"\u26a0\ufe0f",style:{background:"#F59E0B",color:"#fff"},...t})}info(e,t){return r.kg.info("Toast info shown",{message:e}),(0,n.ZP)(e,{duration:4e3,icon:"\u2139\ufe0f",style:{background:"#3B82F6",color:"#fff"},...t})}loading(e,t){return n.ZP.loading(e,{style:{background:"#6B7280",color:"#fff"},...t})}dismiss(e){n.ZP.dismiss(e)}dismissAll(){n.ZP.dismiss()}async promise(e,t,s){const o=this.loading(t.loading,s);try{const i=await e,a="function"===typeof t.success?t.success(i):t.success;return n.ZP.success(a,{id:o,duration:4e3,style:{background:"#10B981",color:"#fff"},...s}),r.kg.info("Promise toast success",{successMessage:a}),i}catch(i){const e="function"===typeof t.error?t.error(i):t.error;throw n.ZP.error(e,{id:o,duration:6e3,style:{background:"#EF4444",color:"#fff"},...s}),r.kg.error("Promise toast error",i instanceof Error?i:new Error(String(i)),{errorMessage:e}),i}}},i=(e,t)=>o.success(e,t),a=(e,t,s)=>o.error(e,t,s),c=(e,t)=>o.warning(e,t),u=(e,t)=>o.info(e,t),l=(e,t)=>o.loading(e,t),d=e=>o.dismiss(e),f=()=>o.dismissAll(),h=()=>({success:i,error:a,warning:c,info:u,loading:l,dismiss:d,dismissAll:f,promise:o.promise.bind(o)})}}]);