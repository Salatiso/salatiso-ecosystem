<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HRHelp - Life CV / Dynamic Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@700;900&family=Manrope:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-color: #3b82f6; /* blue-500 */
            --brand-color-dark: #60a5fa; /* blue-400 */
        }
        body { 
            font-family: 'Manrope', sans-serif; 
            background-color: #f1f5f9; /* slate-100 */
            color: #0f172a; /* slate-900 */
            line-height: 1.6; 
        }
        .dark body {
            background-color: #020617; /* slate-950 */
            color: #e2e8f0; /* slate-200 */
        }
        .document-page { 
            width: 210mm; 
            min-height: 297mm; 
            background-color: #ffffff; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); 
            margin: 2rem auto; 
            border-radius: 0.5rem; 
            border: 1px solid #e2e8f0; /* slate-200 */
            display: flex; 
            flex-direction: column; 
            position: relative; 
        }
        .dark .document-page {
            background-color: #1e293b; /* slate-800 */
            box-shadow: 0 10px 25px rgba(0,0,0,0.5);
            border-color: #334155; /* slate-700 */
        }
        .cover-page, .back-cover-page { justify-content: space-between; align-items: center; padding: 2rem 1.5rem; text-align: center; }
        .hrhelp-logo-svg { height: 80px; width: auto; }
        .dark .hrhelp-logo-svg .logo-text-dark { fill: white; }
        .hrhelp-logo-svg .logo-accent { fill: var(--brand-color); }
        .dark .hrhelp-logo-svg .logo-accent-dark { fill: var(--brand-color-dark); }
        .cover-title { font-size: 2.5rem; font-weight: 900; line-height: 1.2; color: var(--brand-color); text-transform: uppercase; margin-bottom: 1rem; font-family: 'Roboto Slab', serif; }
        .dark .cover-title { color: var(--brand-color-dark); }
        .page-footer { position: absolute; bottom: 1cm; left: 2cm; right: 2cm; display: flex; justify-content: space-between; font-size: 10pt; color: #64748b; }
        .content-page { padding: 2.5cm 2cm; flex-grow: 1; position: relative; }
        h1, h2, h3 { font-family: 'Roboto Slab', serif; color: var(--brand-color); }
        .dark h1, .dark h2, .dark h3 { color: var(--brand-color-dark); }
        h1 { font-size: 2.25rem; font-weight: 900; margin-bottom: 0.5rem; }
        h2 { font-size: 1.75rem; margin-top: 2rem; margin-bottom: 1rem; border-bottom: 1px solid #cbd5e1; padding-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; }
        .dark h2 { border-color: #475569; }
        [contenteditable="true"] { outline: 2px dashed transparent; transition: all 0.3s; padding: 0.25rem; border-radius: 0.25rem; }
        [contenteditable="true"]:focus, [contenteditable="true"]:hover { outline-color: var(--brand-color); background-color: rgba(59, 130, 246, 0.05); }
        .dark [contenteditable="true"]:focus, .dark [contenteditable="true"]:hover { outline-color: var(--brand-color-dark); background-color: rgba(96, 165, 250, 0.1); }
        .action-buttons { position: fixed; top: 1rem; right: 1rem; display: flex; flex-direction: column; gap: 0.75rem; z-index: 1001; background-color: rgba(30, 41, 59, 0.8); backdrop-filter: blur(5px); padding: 1rem; border-radius: 0.75rem; border: 1px solid #334155; }
        .action-buttons button { background-color: #334155; color: #f1f5f9; border: 1px solid #475569; border-radius: 0.5rem; padding: 0.5rem 1rem; cursor: pointer; transition: all 0.2s ease; text-align: left; display: flex; align-items: center; gap: 0.5rem; }
        .action-buttons button:hover { background-color: var(--brand-color); border-color: var(--brand-color-dark); }
        .page-actions { position: absolute; top: 0.5rem; right: 0.5rem; display: flex; gap: 0.25rem; }
        .page-actions button, .section-remove-btn { background: #475569; border: none; color: white; border-radius: 50%; width: 24px; height: 24px; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
        .section-remove-btn:hover { background-color: #ef4444; }
        .toc-list ul { list-style-type: none; padding-left: 0; }
        .toc-list li a { text-decoration: none; color: #334155; display: block; padding: 0.25rem 0; }
        .dark .toc-list li a { color: #94a3b8; }
        .toc-list li a:hover { color: var(--brand-color); }
        .dark .toc-list li a:hover { color: var(--brand-color-dark); }
        .cv-section .section-item { margin-bottom: 1.5rem; }
        .cv-section .item-title { font-weight: bold; font-size: 1.1rem; }
        .placeholder-text { color: #94a3b8; font-style: italic; border: 1px dashed #cbd5e1; padding: 1rem; border-radius: 0.25rem; }
        .dark .placeholder-text { color: #64748b; border-color: #475569; }
        @media print {
            body { background-color: white; color: black; }
            .document-page { box-shadow: none; margin: 0; border: none; page-break-after: always; color: black; background-color: white; }
            .action-buttons, .page-actions, .section-remove-btn { display: none !important; }
            .dark .document-page, .dark body { background-color: white !important; color: black !important; }
            .dark h1, .dark h2, .dark h3, .dark .cover-title { color: var(--brand-color) !important; }
            .dark .hrhelp-logo-svg .logo-text-dark { fill: black; }
            .dark .hrhelp-logo-svg .logo-accent-dark, .hrhelp-logo-svg .logo-accent { fill: var(--brand-color) !important; }
            [contenteditable="true"] { outline: none !important; }
        }
    </style>
</head>
<body>
    <!-- UI Controls -->
    <div class="action-buttons">
        <button onclick="window.print()"><i class="fas fa-print fa-fw"></i><span>Print / Save PDF</span></button>
        <button onclick="shareDocument()"><i class="fas fa-share-alt fa-fw"></i><span>Share Profile</span></button>
        <button id="restore-pages-btn" onclick="restoreDefaultPages()" class="hidden"><i class="fas fa-undo fa-fw"></i><span>Restore Pages</span></button>
    </div>

    <!-- Front Cover -->
    <div class="document-page cover-page" data-page-type="cover">
        <div class="text-center mb-8">
            <img id="profile-pic-cover" src="https://placehold.co/120x120/3b82f6/FFFFFF?text=Me" alt="Profile Picture" class="w-32 h-32 rounded-full object-cover border-4 border-blue-500 dark:border-blue-400 inline-block">
        </div>
        <div class="flex flex-col justify-center items-center flex-grow">
            <h1 class="cover-title" contenteditable="true" data-bind="cvName">Your Name</h1>
            <p class="text-lg mt-2 text-slate-600 dark:text-slate-400" contenteditable="true" data-bind="cvTagline">Your professional tagline or mission statement.</p>
        </div>
        <div class="w-full max-w-md mx-auto text-left text-sm">
             <div id="cover-details" class="border border-slate-200 dark:border-slate-700 rounded-lg p-4 space-y-2">
                <!-- Cover details will be populated by JS -->
             </div>
             <button onclick="addCoverField()" class="text-xs text-blue-600 dark:text-blue-400 hover:underline mt-2"><i class="fas fa-plus-circle mr-1"></i>Add Custom Field</button>
        </div>
    </div>
    
    <!-- Table of Contents Page -->
    <div class="document-page content-page" data-page-type="toc">
        <div class="page-actions"><button onclick="togglePageVisibility(this)" title="Hide Page"><i class="fas fa-times"></i></button></div>
        <h2 class="!mt-0">Table of Contents</h2>
        <div id="toc-container" class="toc-list"></div>
        <div class="page-footer"><span>&copy; <span class="current-year"></span> HRHelp</span><span data-bind="cvName">[Your Name]</span> - Life CV<span>Page <span class="page-number"></span> of <span class="total-pages"></span></span></div>
    </div>

    <!-- Main Content Page -->
    <div class="document-page content-page" data-page-type="content">
        <main id="main-content">
            <section id="summary-section" class="cv-section">
                <h2 class="!mt-0" data-toc-title="Holistic Summary">
                    <span><i class="fas fa-user-circle mr-3 text-slate-400"></i>Holistic Summary</span>
                    <button class="section-remove-btn" onclick="removeSection(this)" title="Remove Section">&times;</button>
                </h2>
                <p id="cv-summary" contenteditable="true">A brief narrative about your journey, skills, and aspirations. This is where you tell your unique story.</p>
            </section>

            <section id="experience-section" class="cv-section">
                <h2 data-toc-title="Professional & Life Experience">
                    <span><i class="fas fa-briefcase mr-3 text-slate-400"></i>Professional & Life Experience</span>
                    <button class="section-remove-btn" onclick="removeSection(this)" title="Remove Section">&times;</button>
                </h2>
                <div id="cv-experience-list"></div>
            </section>

            <section id="skills-section" class="cv-section">
                <h2 data-toc-title="Acquired Skills & Knowledge">
                    <span><i class="fas fa-cogs mr-3 text-slate-400"></i>Acquired Skills & Knowledge</span>
                    <button class="section-remove-btn" onclick="removeSection(this)" title="Remove Section">&times;</button>
                </h2>
                <div id="cv-skills-list"></div>
            </section>
            
            <section id="portfolio-section" class="cv-section">
                <h2 data-toc-title="Portfolio of Work">
                    <span><i class="fas fa-stream mr-3 text-slate-400"></i>Portfolio of Work</span>
                    <button class="section-remove-btn" onclick="removeSection(this)" title="Remove Section">&times;</button>
                </h2>
                <div id="cv-portfolio-list"></div>
            </section>

            <section id="contribution-section" class="cv-section">
                <h2 data-toc-title="Community Contributions">
                    <span><i class="fas fa-users mr-3 text-slate-400"></i>Community Contributions</span>
                    <button class="section-remove-btn" onclick="removeSection(this)" title="Remove Section">&times;</button>
                </h2>
                <div id="cv-contribution-list"></div>
            </section>
            
            <section id="education-section" class="cv-section">
                <h2 data-toc-title="Formal Credentials">
                    <span><i class="fas fa-graduation-cap mr-3 text-slate-400"></i>Formal Credentials</span>
                    <button class="section-remove-btn" onclick="removeSection(this)" title="Remove Section">&times;</button>
                </h2>
                <div id="cv-education-list"></div>
            </section>
        </main>
        <div class="page-footer"><span>&copy; <span class="current-year"></span> HRHelp</span><span data-bind="cvName">[Your Name]</span> - Life CV<span>Page <span class="page-number"></span> of <span class="total-pages"></span></span></div>
    </div>

    <!-- Back Cover -->
    <div class="document-page back-cover-page" data-page-type="back-cover" style="background-color: #1e293b;">
        <div class="text-center mb-8">
             <div class="hrhelp-logo-svg inline-block">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 280 60" class="hrhelp-logo-svg">
                    <g class="logo-accent-dark logo-accent" fill="#60a5fa"><path d="M54.4,22.4c-5.3-5.3-13.8-5.3-19.1,0L32,25.7l-3.3-3.3c-5.3-5.3-13.8-5.3-19.1,0c-5.3,5.3-5.3,13.8,0,19.1L22,54l2.2,2.2c1,1,2.6,1,3.5,0L32,52.1l4.2-4.2l-8.4-8.4l5.3-5.3l8.4,8.4L48,38.4l9.6-9.6C62.9,29.6,59.7,25.6,54.4,22.4z"/><circle cx="12.8" cy="12.8" r="8"/><circle cx="51.2" cy="12.8" r="8"/></g>
                    <text x="70" y="45" font-family="Roboto Slab, serif" font-size="40" font-weight="700" class="logo-text-dark" fill="white">HR</text>
                    <text x="120" y="45" font-family="Roboto Slab, serif" font-size="40" font-weight="900" class="logo-accent-dark logo-accent" fill="#60a5fa">Help</text>
                </svg>
            </div>
        </div>
        <div class="flex-grow flex flex-col justify-center items-center">
            <h2 class="text-blue-400">The Builder's Ethos</h2>
            <div class="text-center space-y-1 text-slate-300 text-sm">
                <div><strong>STRUCTURE:</strong> 🛡️ We build organised, logical, and robust systems.</div>
                <div><strong>ASSEMBLE:</strong> 🧩 We bring together disparate parts to create a cohesive whole.</div>
                <div><strong>LEGACY:</strong> 🦅 We build upon the work of our predecessors.</div>
                <div><strong>ARCHITECT:</strong> 🏛️ We design with vision and purpose for the future.</div>
                <div><strong>TOOL-UP:</strong> 🛠️ We empower users with the right tools and knowledge.</div>
                <div><strong>INNOVATE:</strong> 💡 We constantly seek better ways to solve problems.</div>
                <div><strong>SUSTAIN:</strong> 🌱 We build things that are meant to last.</div>
                <div><strong>OBSERVE:</strong> 👁️ We pay close attention to identify needs and find solutions.</div>
            </div>
        </div>
        <div class="text-xs text-slate-500 mt-auto pt-4"><span>A Salatiso Initiative</span> | <span>hrhelp@salatiso.com</span> | <span>&copy; <span class="current-year"></span> HRHelp</span></div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            initializeDataBinding();
            
            const cvData = JSON.parse(localStorage.getItem('lifeCvData'));
            if (cvData) {
                populateCV(cvData);
            } else {
                console.log("No Life CV data found. Using placeholders.");
                initializeCoverDetails(); // Initialize with placeholders
                populateCV({}); // Populate with empty data to get placeholders
            }
            
            generateTOC();
            updatePageNumbers();
            
            document.querySelectorAll('.current-year').forEach(el => el.textContent = new Date().getFullYear());
        });

        function initializeDataBinding() {
            document.body.addEventListener('input', (e) => {
                const target = e.target;
                if (target.hasAttribute('data-bind')) {
                    const bindKey = target.getAttribute('data-bind');
                    const value = target.innerHTML;
                    document.querySelectorAll(`[data-bind="${bindKey}"]`).forEach(elem => {
                        if (elem !== target) elem.innerHTML = value;
                    });
                }
            });
        }
        
        function initializeCoverDetails(data = {}) {
            const personal = data.personal || {};
            const details = [
                { label: 'Email', value: personal.email || '[Enter Email]' },
                { label: 'Phone', value: personal.phone || '[Enter Phone]' },
                { label: 'LinkedIn', value: personal.linkedin || '[Enter LinkedIn URL]' },
                { label: 'Version', value: '1.0' },
                { label: 'Date', value: new Date().toLocaleDateString('en-CA') },
            ];
            details.forEach(d => addCoverField(d.label, d.value));
        }

        function addCoverField(label = 'Custom Field', value = '[Enter Value]', bindKey = null) {
            const container = document.getElementById('cover-details');
            if (!container) return;
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'flex items-center border-b border-slate-200 dark:border-slate-700 pb-1';
            
            const labelEl = document.createElement('strong');
            labelEl.className = 'w-28 text-slate-500 dark:text-slate-400';
            labelEl.setAttribute('contenteditable', 'true');
            labelEl.textContent = label;
            
            const valueEl = document.createElement('span');
            valueEl.className = 'flex-grow';
            valueEl.setAttribute('contenteditable', 'true');
            if(bindKey) valueEl.setAttribute('data-bind', bindKey);
            valueEl.innerHTML = value;

            const removeBtn = document.createElement('button');
            removeBtn.className = 'ml-2 text-red-500 hover:text-red-700 text-xs hidden';
            removeBtn.innerHTML = '<i class="fas fa-times-circle"></i>';
            removeBtn.onclick = () => fieldDiv.remove();
            
            fieldDiv.addEventListener('mouseenter', () => removeBtn.classList.remove('hidden'));
            fieldDiv.addEventListener('mouseleave', () => removeBtn.classList.add('hidden'));

            fieldDiv.append(labelEl, valueEl, removeBtn);
            container.appendChild(fieldDiv);
        }

        function generateTOC() {
            const tocContainer = document.getElementById('toc-container');
            if (!tocContainer) return;
            tocContainer.innerHTML = ''; // Clear existing TOC
            const tocList = document.createElement('ul');
            const headings = document.querySelectorAll('#main-content h2');
            headings.forEach((h, index) => {
                if (h.parentElement.style.display === 'none') return; // Skip hidden sections
                const title = h.dataset.tocTitle || h.textContent;
                const anchorId = `section-${index}`;
                h.id = anchorId;
                const listItem = document.createElement('li');
                listItem.innerHTML = `<a href="#${anchorId}">${title}</a>`;
                tocList.appendChild(listItem);
            });
            if (tocList.children.length === 0) {
                tocContainer.innerHTML = '<p class="text-slate-500">No sections found in document.</p>';
            } else {
                tocContainer.appendChild(tocList);
            }
        }

        function updatePageNumbers() {
            const pages = Array.from(document.querySelectorAll('.document-page:not(.hidden)'));
            pages.forEach((page, index) => {
                const pageNumEl = page.querySelector('.page-number');
                const totalPagesEl = page.querySelector('.total-pages');
                if(pageNumEl) pageNumEl.textContent = index + 1;
                if(totalPagesEl) totalPagesEl.textContent = pages.length;
            });
        }

        function togglePageVisibility(button) {
            const page = button.closest('.document-page');
            page.classList.add('hidden');
            document.getElementById('restore-pages-btn').classList.remove('hidden');
            updatePageNumbers();
        }
        
        function removeSection(button) {
            const section = button.closest('section');
            section.style.display = 'none';
            generateTOC(); // Regenerate TOC after removing a section
        }

        function restoreDefaultPages() {
            document.querySelectorAll('.document-page.hidden, #main-content section[style*="display: none"]').forEach(p => p.style.display = '');
            document.getElementById('restore-pages-btn').classList.add('hidden');
            updatePageNumbers();
            generateTOC();
        }
        
        function shareDocument() { 
            alert('Share functionality is coming soon!');
        }

        function populateCV(data) {
            const p = data.personal || {};
            const entries = data.entries || [];

            // Populate cover
            document.querySelector('[data-bind="cvName"]').innerHTML = p.name || 'Your Name';
            document.querySelector('[data-bind="cvTagline"]').innerHTML = p.tagline || 'Your tagline.';
            if(p.profilePic) document.getElementById('profile-pic-cover').src = p.profilePic;
            
            document.getElementById('cover-details').innerHTML = '';
            initializeCoverDetails(data);

            document.getElementById('cv-summary').innerHTML = p.summary || 'No summary provided.';

            const listMapping = {
                experience: { id: 'cv-experience-list', placeholder: 'Detail your work history, including roles, responsibilities, and key achievements. Also include significant life experiences that contributed to your growth.' },
                skill: { id: 'cv-skills-list', placeholder: 'List both technical skills (e.g., software, languages) and soft skills (e.g., leadership, communication). You can also mention knowledge gained from life or informal learning.' },
                portfolio: { id: 'cv-portfolio-list', placeholder: 'Showcase your work. This can include links to projects, documents you created, or descriptions of tangible outcomes you delivered.' },
                contribution: { id: 'cv-contribution-list', placeholder: 'Describe your contributions to your community, family, or any group. This could be volunteering, mentoring, or taking on key responsibilities.' },
                education: { id: 'cv-education-list', placeholder: 'List your formal qualifications, such as degrees, diplomas, and certifications, along with the institutions and dates.' }
            };
            
            for (const type in listMapping) {
                const config = listMapping[type];
                const container = document.getElementById(config.id);
                container.innerHTML = ''; // Clear previous content
                
                const typeEntries = entries.filter(entry => entry.type === type);

                if (typeEntries.length > 0) {
                    typeEntries.forEach(entry => {
                        const item = document.createElement('div');
                        item.className = 'section-item';
                        item.innerHTML = `
                            <div class="item-title" contenteditable="true">${entry.title}</div>
                            <p class="text-slate-600 dark:text-slate-400" contenteditable="true">${entry.description}</p>
                        `;
                        container.appendChild(item);
                    });
                } else {
                    // Add placeholder if no entries exist for this type
                    const placeholder = document.createElement('div');
                    placeholder.className = 'placeholder-text';
                    placeholder.setAttribute('contenteditable', 'true');
                    placeholder.innerHTML = config.placeholder;
                    container.appendChild(placeholder);
                }
            }
        }
    </script>
</body>
</html>
